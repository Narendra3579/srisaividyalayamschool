<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sri Sai Vidyalayam - Admin Portal</title>
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- Fonts and Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
    <style>
        body { font-family: 'Open Sans', sans-serif; overflow-x: hidden; }
        h1, h2, h3, .brand-font { font-family: 'Playfair Display', serif; }
        
        .modal { transition: opacity 0.2s ease-in-out; }
        .hidden-modal { opacity: 0; pointer-events: none; }
        
        /* Video Aspect Ratio Containers - Default 16:9 */
        .video-container { 
            position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; 
            background: #0f172a; border-radius: 24px; cursor: pointer; 
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        /* Vertical Ratio 9:16 for Shorts/Reels */
        .video-container.vertical { padding-bottom: 177.77%; }

        .video-container iframe, .video-container video { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            border: none !important; object-fit: cover;
        }

        /* Container for raw HTML embeds */
        .embed-wrapper {
            width: 100%;
            border-radius: 24px;
            overflow: hidden;
            background: #f8fafc;
            display: flex;
            justify-content: center;
            min-height: 450px;
        }
        .embed-wrapper iframe { width: 100% !important; border: none !important; min-height: 450px; }

        /* BLOG SLIDER STYLES */
        .blog-slider-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            overflow: hidden;
        }
        .blog-slider-track {
            display: flex;
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .blog-slide {
            flex: 0 0 100%;
            padding: 0 10px;
            box-sizing: border-box;
        }

        /* PRINT STYLES */
        #printable-area { display: none; }
        @media print {
            body * { visibility: hidden !important; }
            #printable-area, #printable-area * { visibility: visible !important; }
            #printable-area { 
                display: block !important; position: absolute !important; 
                left: 0 !important; top: 0 !important; width: 100% !important; 
                background: white !important; color: black !important;
                margin: 0 !important; padding: 20px !important;
            }
        }

        /* LANDING PAGE ANIMATIONS */
        .cloud-slow { animation: drift 60s linear infinite; }
        .cloud-very-slow { animation: drift 90s linear infinite; }
        @keyframes drift { 
            from { transform: translateX(-150px); } 
            to { transform: translateX(950px); } 
        }

        .bird-fly { animation: flyAcross 80s linear infinite; }
        @keyframes flyAcross {
            from { transform: translate(-150px, 60px); }
            to { transform: translate(950px, 30px); }
        }
        .bird-wing { animation: flap 2.5s ease-in-out infinite alternate; transform-origin: center; }
        @keyframes flap {
            from { transform: scaleY(1); }
            to { transform: scaleY(0.2); }
        }

        .bus-drive { animation: driveAcross 18s linear infinite; transform-box: view-box; }
        @keyframes driveAcross { from { transform: translateX(850px); } to { transform: translateX(-250px); } }

        #hero-text-slider .slide { display: none; }
        #hero-text-slider .slide.active { display: block; animation: slideUpFade 0.8s ease-out; }
        @keyframes slideUpFade { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        /* SPLASH SCREEN */
        #cloud-loader {
            position: fixed; inset: 0; background: #ffffff; z-index: 1000; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .book-wrap { width: 100px; height: 70px; position: relative; perspective: 500px; }
        .book-base { width: 100%; height: 100%; background: #f8fafc; border: 3px solid #1e3a8a; border-radius: 2px 5px 5px 2px; position: absolute; left: 0; top: 0; }
        .book-cover { width: 50%; height: 100%; background: #1e3a8a; position: absolute; right: 0; top: 0; transform-origin: left; border-radius: 0 5px 5px 0; animation: openBook 2.5s infinite ease-in-out; z-index: 2; }
        .book-page { width: 48%; height: 90%; background: white; position: absolute; right: 1%; top: 5%; border-left: 1px solid #cbd5e1; z-index: 1; }
        @keyframes openBook {
            0%, 20% { transform: rotateY(0deg); }
            50%, 75% { transform: rotateY(-155deg); }
            100% { transform: rotateY(0deg); }
        }

        /* NOTIFICATION BADGE */
        .nav-badge {
            position: absolute; top: 2px; right: -8px;
            background: #ef4444; color: white;
            font-size: 10px; font-weight: 800;
            padding: 2px 6px; border-radius: 9999px;
            border: 2px solid #1e1b4b;
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0) scale(0.9);}
            40% {transform: translateY(-3px) scale(1);}
        }
        
        .play-overlay {
            position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.3); transition: background 0.3s;
            z-index: 10;
        }
        .play-overlay:hover { background: rgba(0,0,0,0.5); }
        .sync-pulse { width: 8px; height: 8px; background: #10b981; border-radius: 50%; display: inline-block; animation: pulse 2s infinite; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-bold">

    <!-- SPLASH SCREEN -->
    <div id="cloud-loader">
        <div class="loader-container mb-6">
            <div class="book-wrap">
                <div class="book-base"></div>
                <div class="book-page"></div>
                <div class="book-cover"></div>
            </div>
        </div>
        <p id="loader-text" class="text-xs font-bold tracking-[0.3em] uppercase text-indigo-900">Sri Sai Vidyalayam</p>
    </div>

    <!-- TOAST -->
    <div id="status-toast" class="bg-indigo-950 text-white px-6 py-3 rounded-xl shadow-2xl flex items-center gap-3 font-bold border border-indigo-700 hidden" style="position:fixed; bottom:20px; right:20px; z-index:200;">
        <span class="material-symbols-outlined text-amber-400" id="toast-icon">sync</span>
        <span id="toast-msg">Syncing...</span>
    </div>

    <!-- NAVBAR -->
    <nav class="bg-indigo-950 text-white shadow-xl sticky top-0 z-40 no-print border-b border-indigo-800">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center space-x-4 cursor-pointer group" onclick="router.navigate('home')">
                    <div class="bg-white text-indigo-950 h-12 w-12 rounded-2xl flex items-center justify-center font-bold text-xl border-2 border-amber-400 transform group-hover:rotate-6 transition font-bold">SSV</div>
                    <div>
                        <h1 class="text-2xl font-bold tracking-tight leading-none uppercase">Sri Sai Vidyalayam</h1>
                        <p class="text-[9px] text-amber-400 uppercase tracking-[0.3em] font-black mt-1 text-center">Excellence in Education</p>
                    </div>
                </div>
                <div class="hidden md:flex space-x-4 items-center font-bold">
                    <button class="hover:bg-indigo-800/50 px-4 py-2 rounded-lg transition text-sm uppercase" onclick="router.navigate('home')">Home</button>
                    <button class="relative hover:bg-indigo-800/50 px-4 py-2 rounded-lg transition text-sm uppercase" onclick="router.navigate('updates')">
                        Daily Updates
                        <span id="nav-updates-badge" class="nav-badge hidden">0</span>
                    </button>
                    <button class="bg-amber-500 hover:bg-amber-400 text-indigo-950 px-5 py-2.5 rounded-xl transition flex items-center gap-2 shadow-lg shadow-amber-500/20 text-xs uppercase font-bold" onclick="router.navigate('login')">
                        <span class="material-symbols-outlined text-lg font-bold">admin_panel_settings</span> Admin Login
                    </button>
                </div>
                <button class="md:hidden p-2 rounded-lg bg-indigo-800" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
                    <span class="material-symbols-outlined text-3xl font-bold">menu</span>
                </button>
            </div>
        </div>
        <!-- MOBILE MENU -->
        <div class="hidden md:hidden bg-indigo-900 border-t border-indigo-800 p-4" id="mobile-menu">
            <button class="block w-full text-left py-3 px-4 rounded-xl hover:bg-indigo-800 mb-1 font-bold" onclick="router.navigate('home'); document.getElementById('mobile-menu').classList.add('hidden')">Home</button>
            <button class="block w-full text-left py-3 px-4 rounded-xl hover:bg-indigo-800 mb-1 relative font-bold" onclick="router.navigate('updates'); document.getElementById('mobile-menu').classList.add('hidden')">
                Daily Updates
                <span id="mobile-updates-badge" class="ml-2 inline-block bg-red-500 text-white px-2 py-0.5 rounded-full text-[10px] hidden">0</span>
            </button>
            <button class="block w-full text-left py-3 px-4 bg-amber-500 text-indigo-950 rounded-xl font-bold uppercase text-xs" onclick="router.navigate('login'); document.getElementById('mobile-menu').classList.add('hidden')">Admin Login</button>
        </div>
    </nav>

    <div id="app">
        <!-- VIEW: HOME -->
        <div id="view-home" class="min-h-screen hidden">
            <!-- HERO -->
            <section class="hero-bg pt-12 md:pt-20 pb-0 border-b border-slate-200 min-h-[550px] flex flex-col">
                <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center flex-1">
                    <div class="relative z-10 text-center lg:text-left space-y-6">
                        <span class="inline-block px-4 py-1.5 bg-indigo-100 text-indigo-700 rounded-full text-xs font-bold uppercase tracking-widest">Recognised by Govt of AP</span>
                        <div id="hero-text-slider" class="min-h-[220px]">
                            <div class="slide active">
                                <h2 class="text-5xl md:text-7xl font-extrabold text-indigo-950 leading-[1.1]">Pollution Free <br><span class="text-green-600 underline decoration-amber-400 underline-offset-8">Green Campus</span></h2>
                                <p class="text-lg text-slate-600 mt-4 font-medium leading-relaxed">A serene environment located away from city noise and dust, ensuring a healthy learning space.</p>
                            </div>
                            <div class="slide">
                                <h2 class="text-5xl md:text-7xl font-extrabold text-indigo-950 leading-[1.1]">Expert & <br><span class="text-orange-500 underline decoration-amber-400 underline-offset-8">Dedicated Faculty</span></h2>
                                <p class="text-lg text-slate-600 mt-4 font-medium leading-relaxed">Qualified subject experts committed to personalized attention and academic excellence.</p>
                            </div>
                            <div class="slide">
                                <h2 class="text-5xl md:text-7xl font-extrabold text-indigo-950 leading-[1.1]">Safe & Secure <br><span class="text-red-600 underline decoration-amber-400 underline-offset-8">No Traffic Risk</span></h2>
                                <p class="text-lg text-slate-600 mt-4 font-medium leading-relaxed">Located in a peaceful residential zone with zero heavy traffic risks for students.</p>
                            </div>
                        </div>
                        <button onclick="router.navigate('updates')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-4 rounded-2xl font-bold shadow-xl transition active:scale-95">View Daily Board</button>
                    </div>
                    <div class="relative h-[300px] md:h-[450px]">
                        <svg viewBox="0 0 800 500" class="w-full h-full" preserveAspectRatio="xMidYMid meet">
                            <circle cx="700" cy="80" r="45" fill="#FFF176" />
                            <!-- ULTRA SLOW BIRDS -->
                            <g class="bird-fly">
                                <g transform="translate(0,0)"><path class="bird-wing" d="M0,0 Q5,-8 10,0 Q15,-8 20,0" stroke="#334155" stroke-width="2" fill="none" /></g>
                                <g transform="translate(50,25)"><path class="bird-wing" d="M0,0 Q5,-8 10,0 Q15,-8 20,0" stroke="#334155" stroke-width="2" fill="none" /></g>
                                <g transform="translate(-30,50)"><path class="bird-wing" d="M0,0 Q5,-8 10,0 Q15,-8 20,0" stroke="#334155" stroke-width="2" fill="none" /></g>
                            </g>
                            <!-- SKY BLUE CLOUDS -->
                            <g class="cloud-very-slow" opacity="0.7">
                                <g transform="translate(100,120)"><circle cx="0" cy="0" r="25" fill="#87CEEB" /><circle cx="30" cy="0" r="30" fill="#87CEEB" /><circle cx="60" cy="0" r="25" fill="#87CEEB" /></g>
                            </g>
                            <g class="cloud-slow" opacity="0.9">
                                <g transform="translate(450,60)"><circle cx="0" cy="0" r="15" fill="#87CEEB" /><circle cx="15" cy="0" r="20" fill="#87CEEB" /><circle cx="35" cy="0" r="15" fill="#87CEEB" /></g>
                            </g>
                            <rect x="0" y="400" width="800" height="100" fill="#334155" />
                            <g class="bus-drive">
                                <rect x="0" y="340" width="160" height="70" rx="12" fill="#fbbf24" />
                                <rect x="15" y="350" width="30" height="20" rx="2" fill="#f8fafc" opacity="0.8" />
                                <rect x="55" y="350" width="30" height="20" rx="2" fill="#f8fafc" opacity="0.8" />
                                <rect x="95" y="350" width="50" height="20" rx="2" fill="#f8fafc" opacity="0.8" />
                                <circle cx="40" cy="410" r="12" fill="#1e293b" />
                                <circle cx="120" cy="410" r="12" fill="#1e293b" />
                                <text x="80" y="385" font-family="sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#431407">SRI SAI VIDYALAYAM</text>
                            </g>
                        </svg>
                    </div>
                </div>
            </section>
            
            <!-- RECENT BLOG SECTION WITH SLIDER -->
            <section class="max-w-7xl mx-auto px-4 py-24 text-center">
                <h2 class="text-4xl font-black text-indigo-950 uppercase mb-8 border-b-4 border-amber-400 inline-block pb-2">Recent Highlights</h2>
                
                <div class="flex items-center justify-center gap-4 mt-8">
                    <!-- PREV BUTTON -->
                    <button onclick="home.prevBlog()" class="w-12 h-12 rounded-full bg-white shadow-lg flex items-center justify-center text-indigo-950 hover:bg-indigo-950 hover:text-white transition-all">
                        <span class="material-symbols-outlined font-bold">arrow_back_ios_new</span>
                    </button>

                    <div class="blog-slider-container">
                        <div id="blog-posts-feed" class="blog-slider-track">
                            <!-- Loaded via home.renderBlog() -->
                        </div>
                    </div>

                    <!-- NEXT BUTTON -->
                    <button onclick="home.nextBlog()" class="w-12 h-12 rounded-full bg-white shadow-lg flex items-center justify-center text-indigo-950 hover:bg-indigo-950 hover:text-white transition-all">
                        <span class="material-symbols-outlined font-bold">arrow_forward_ios</span>
                    </button>
                </div>
            </section>
        </div>

        <!-- VIEW: DAILY UPDATES -->
        <div id="view-updates" class="min-h-screen hidden bg-slate-50 py-12">
            <div class="max-w-5xl mx-auto px-4 font-bold">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-black text-indigo-950 uppercase tracking-tighter">Daily Board & Notices</h2>
                </div>
                <div class="bg-indigo-950 rounded-[40px] shadow-2xl p-8 mb-12 font-bold">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-6 mb-8 font-bold">
                        <h3 class="text-2xl font-black text-white uppercase flex items-center gap-3 font-bold">
                            <span class="material-symbols-outlined text-amber-400 text-4xl font-bold">campaign</span> Class Wise Board
                        </h3>
                        <div class="w-full md:w-64">
                            <select id="board-class-filter" class="w-full bg-indigo-900 border border-indigo-700 text-white rounded-2xl p-4 font-bold outline-none" onchange="home.renderUpdates()"></select>
                        </div>
                    </div>
                    <ul id="board-updates-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></ul>
                </div>
                <div class="text-center font-bold"><button onclick="router.navigate('home')" class="text-indigo-600 font-bold hover:underline">Back to Home</button></div>
            </div>
        </div>

        <!-- VIEW: LOGIN -->
        <div id="view-login" class="min-h-screen bg-gray-100 flex items-center justify-center p-4 hidden">
            <div class="bg-white w-full max-w-md p-10 rounded-3xl shadow-2xl font-bold border">
                <div class="text-center mb-8">
                    <span class="material-symbols-outlined text-6xl text-blue-900 mb-2 font-bold">admin_panel_settings</span>
                    <h2 class="text-3xl font-bold uppercase">Admin Login</h2>
                </div>
                <form onsubmit="auth_manager.login(event)" class="space-y-6">
                    <div><label class="block text-sm font-bold text-slate-600">User ID</label><input type="text" id="userid" class="w-full border-2 p-3 rounded-xl outline-none focus:border-blue-500 font-bold" required></div>
                    <div><label class="block text-sm font-bold text-slate-600">Password</label><input type="password" id="password" class="w-full border-2 p-3 rounded-xl outline-none focus:border-blue-500" required></div>
                    <button type="submit" class="w-full bg-blue-900 text-white font-black py-4 rounded-2xl shadow-lg transition active:scale-95 font-bold">Sign In</button>
                </form>
            </div>
        </div>

        <!-- VIEW: ADMIN PANEL -->
        <div id="view-admin" class="min-h-screen bg-gray-50 flex flex-col md:flex-row hidden font-bold">
            <div class="bg-blue-900 text-white w-full md:w-64 flex-shrink-0 flex flex-col md:h-screen md:sticky top-0 no-print shadow-xl font-bold">
                <div class="p-6 border-b border-blue-800 font-black text-xl flex items-center gap-2 font-bold">
                    <span class="material-symbols-outlined text-yellow-400 font-bold">school</span> Admin
                </div>
                <nav class="flex-1 p-4 space-y-1 font-bold">
                    <button class="admin-tab w-full text-left px-4 py-3 rounded-lg hover:bg-blue-800 flex items-center gap-3 transition font-bold" data-tab="dashboard" onclick="admin.switchTab('dashboard')">Dashboard</button>
                    <button class="admin-tab w-full text-left px-4 py-3 rounded-lg hover:bg-blue-800 flex items-center gap-3 transition font-bold" data-tab="admissions" onclick="admin.switchTab('admissions')">Admissions</button>
                    <button class="admin-tab w-full text-left px-4 py-3 rounded-lg hover:bg-blue-800 flex items-center gap-3 transition font-bold" data-tab="students" onclick="admin.switchTab('students')">Records</button>
                    <button class="admin-tab w-full text-left px-4 py-3 rounded-lg hover:bg-blue-800 flex items-center gap-3 transition font-bold" data-tab="dailyboard" onclick="admin.switchTab('dailyboard')">Daily Board</button>
                    <button class="admin-tab w-full text-left px-4 py-3 rounded-lg hover:bg-blue-800 flex items-center gap-3 transition font-bold" data-tab="manage_blog" onclick="admin.switchTab('manage_blog')">Manage Blog</button>
                </nav>
                <div class="p-4 border-t border-blue-800">
                    <button onclick="auth_manager.logout()" class="w-full bg-red-800 text-white py-2 rounded-lg font-bold">Logout</button>
                </div>
            </div>

            <div class="flex-1 p-6 md:p-8 overflow-y-auto font-bold">
                <!-- TABS CONTENT (OMITTED FOR BREVITY AS REQUESTED IN UPDATED FILE PROTOCOL) -->
                <div id="tab-dashboard" class="admin-content space-y-6">
                    <h2 class="text-2xl font-black font-bold">Overview</h2>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 font-bold">
                        <div class="bg-white p-6 rounded-xl shadow border-l-8 border-blue-500 font-bold"><h4>Target</h4><div class="text-3xl font-black text-blue-900" id="stat-total">₹0</div></div>
                        <div class="bg-white p-6 rounded-xl shadow border-l-8 border-orange-400 font-bold"><h4>Old Fee</h4><div class="text-3xl font-black text-orange-600" id="stat-old">₹0</div></div>
                        <div class="bg-white p-6 rounded-xl shadow border-l-8 border-green-500 font-bold"><h4>Collected</h4><div class="text-3xl font-black text-green-600" id="stat-collected">₹0</div></div>
                        <div class="bg-white p-6 rounded-xl shadow border-l-8 border-red-500 font-bold"><h4>Balance</h4><div class="text-3xl font-black text-red-600" id="stat-pending">₹0</div></div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow border h-80 font-bold"><canvas id="feeChart"></canvas></div>
                </div>

                <div id="tab-admissions" class="admin-content hidden space-y-6">
                    <h2 class="text-2xl font-black font-bold">New Admission</h2>
                    <form onsubmit="admin.submitAdmission(event)" class="bg-white rounded-3xl shadow-xl p-8 border grid grid-cols-1 md:grid-cols-2 gap-6 font-bold">
                        <div><label class="block text-sm font-bold">Admn ID</label><input type="text" name="admnNo" class="w-full border-2 p-3 rounded-xl focus:border-blue-500" required></div>
                        <div><label class="block text-sm font-bold">Grade</label><select id="admit-class" name="classGrade" class="w-full border-2 p-3 rounded-xl font-bold"></select></div>
                        <div><label class="block text-sm font-bold">Name</label><input type="text" name="name" class="w-full border-2 p-3 rounded-xl" required></div>
                        <div><label class="block text-sm font-bold">Mobile</label><input type="tel" name="contact" pattern="[0-9]{10}" maxlength="10" class="w-full border-2 p-3 rounded-xl" required></div>
                        <div><label class="block text-sm font-bold">Concession Slip</label><input type="file" id="admit-slip" name="concessionSlip" accept=".jpg,.jpeg,.png,.pdf" class="w-full p-2 border-2 rounded-xl text-xs"></div>
                        <div class="col-span-full grid grid-cols-3 gap-4 border-t pt-6">
                            <div><label class="block text-xs">Yearly Fee</label><input type="number" name="totalFee" class="w-full border-2 p-3 font-black" required></div>
                            <div><label class="block text-xs">Old Fee</label><input type="number" name="oldDue" value="0" class="w-full border-2 p-3 text-orange-600"></div>
                            <div><label class="block text-xs font-bold">Initial Pay</label><input type="number" name="initialPay" value="0" class="w-full border-2 p-3 text-green-600"></div>
                        </div>
                        <button type="submit" class="col-span-full bg-blue-600 text-white py-4 rounded-2xl font-black">Register</button>
                    </form>
                </div>

                <div id="tab-manage_blog" class="admin-content hidden space-y-6">
                    <h2 class="text-2xl font-black font-bold font-bold font-bold font-bold">Blog Management</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 font-bold">
                        <div class="bg-white p-8 rounded-3xl shadow border font-bold">
                            <form onsubmit="admin.addBlogPost(event)" class="space-y-4">
                                <div><label class="block text-sm font-bold">Title</label><input type="text" id="blog-title" class="w-full border-2 p-3 rounded-xl font-bold" required></div>
                                <div class="grid grid-cols-2 gap-4 font-bold">
                                    <input type="date" id="blog-date" class="border p-3 rounded-xl font-bold" required>
                                    <select id="blog-type" class="border p-3 rounded-xl font-bold" onchange="admin.toggleBlogInputs()">
                                        <option value="image">Photo</option>
                                        <option value="local_video">Local Video</option>
                                        <option value="youtube">YouTube Link</option>
                                        <option value="instagram">Instagram Link</option>
                                        <option value="embed">HTML Embed Code</option>
                                    </select>
                                </div>
                                <div id="blog-file-area"><label class="block text-sm">Select File (Max 700KB)</label><input type="file" id="blog-file" class="w-full border-2 p-2 rounded-xl text-xs font-bold" accept="image/*,video/mp4"></div>
                                <div id="blog-url-area" class="hidden"><label class="block text-sm">URL / Link</label><input type="text" id="blog-url" class="w-full border-2 p-3 rounded-xl font-bold" placeholder="https://..."></div>
                                <div id="blog-embed-area" class="hidden"><label class="block text-sm">Paste Embed HTML</label><textarea id="blog-embed" class="w-full border-2 p-3 rounded-xl h-24 text-xs font-mono font-bold" placeholder="<iframe ...></iframe>"></textarea></div>
                                <button type="submit" class="w-full bg-orange-600 text-white py-3 rounded-xl font-bold">Publish</button>
                            </form>
                        </div>
                        <div class="bg-white p-6 rounded-3xl shadow h-[550px] overflow-y-auto font-bold font-bold font-bold font-bold"><ul id="admin-blog-list" class="space-y-3 font-bold font-bold font-bold font-bold font-bold font-bold"></ul></div>
                    </div>
                </div>

                <div id="tab-students" class="admin-content hidden space-y-6">
                    <div class="bg-white rounded-3xl shadow-xl overflow-x-auto"><table class="min-w-full text-sm font-bold"><thead class="bg-gray-50 border-b"><tr><th class="p-5 text-left font-bold">ID</th><th class="p-5 text-left font-bold">Name</th><th class="p-5 text-left">Class</th><th class="p-5 text-left font-black">Net Balance</th><th class="p-5 text-right">Actions</th></tr></thead><tbody id="student-list-body" class="divide-y font-bold font-bold"></tbody></table></div>
                </div>
            </div>
        </div>

        <!-- PROFILE MODAL -->
        <div id="profile-modal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-70 hidden-modal modal no-print p-4">
            <div class="bg-white w-full max-w-5xl h-[90vh] rounded-[3rem] shadow-2xl flex flex-col overflow-hidden font-bold">
                <div class="bg-blue-900 text-white p-6 flex justify-between items-center font-bold font-bold"><h2 id="modal-title" class="text-2xl font-black"></h2><button onclick="admin.closeModal()" class="text-white text-4xl font-bold">&times;</button></div>
                <div class="flex-1 overflow-y-auto p-10 bg-gray-50 font-bold">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 font-bold">
                        <div class="space-y-6 font-bold font-bold">
                            <div class="bg-white p-5 rounded-lg shadow border font-bold">
                                <p>Grade: <span id="modal-class"></span></p>
                                <p>Parent: <span id="modal-father"></span></p>
                                <p>Mobile: <span id="modal-contact"></span></p>
                                <div id="modal-slip-box" class="hidden mt-4 border-t pt-4 font-bold"><button onclick="admin.viewSlip()" class="w-full bg-indigo-50 text-indigo-700 p-2 rounded-xl text-xs font-bold uppercase font-bold">View Slip</button></div>
                            </div>
                            <div class="bg-blue-50 p-5 rounded-3xl border border-blue-200 font-bold font-bold">
                                <div class="flex justify-between font-bold"><span>Old Fee:</span> <span id="modal-fee-old"></span></div>
                                <div class="flex justify-between font-bold text-red-600 font-bold"><span>Balance:</span> <span id="modal-fee-due"></span></div>
                            </div>
                            <button onclick="printer.printLedger()" class="w-full bg-white border-2 p-4 rounded-2xl font-bold shadow-sm font-bold font-bold">Print Ledger</button>
                            <button onclick="admin.showDeleteConfirm()" class="w-full bg-red-50 text-red-600 p-3 rounded-2xl font-bold uppercase text-[10px] font-bold">Delete Record</button>
                        </div>
                        <div class="lg:col-span-2 space-y-6 font-bold">
                            <form onsubmit="admin.payFee(event)" class="bg-white p-8 rounded-3xl shadow border grid grid-cols-2 gap-4 font-bold">
                                <input type="text" id="pay-rec" class="border p-3 rounded-xl font-bold" placeholder="Receipt #" required>
                                <input type="date" id="pay-date" class="border p-3 rounded-xl font-bold" required>
                                <select id="pay-category" class="border p-3 rounded-xl font-bold font-bold"><option>Academic Fee</option><option>Old Fee</option></select>
                                <select id="pay-mode" class="border p-3 rounded-xl font-bold font-bold"><option>Cash</option><option>UPI</option><option>Bank Transfer</option></select>
                                <input type="number" id="pay-amt" class="col-span-2 border-2 border-green-500 p-3 rounded-xl font-black text-2xl font-bold" placeholder="Amount" required>
                                <button type="submit" class="col-span-2 bg-green-600 text-white py-4 rounded-2xl font-bold font-bold font-bold">Confirm Payment</button>
                            </form>
                            <div class="bg-white rounded-3xl shadow border overflow-hidden font-bold font-bold font-bold"><table class="w-full text-xs text-left font-bold"><tbody id="modal-history" class="divide-y font-bold"></tbody></table></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DELETE MODAL -->
        <div id="delete-modal" class="fixed inset-0 z-[110] flex items-center justify-center bg-black bg-opacity-80 hidden-modal modal font-bold">
            <div class="bg-white w-full max-w-sm rounded-[3rem] p-10 text-center shadow-2xl font-bold font-bold">
                <span class="material-symbols-outlined text-6xl text-red-600 mb-2 font-bold">security</span>
                <h3 class="text-xl font-black mb-4 text-red-600 uppercase tracking-widest font-bold">Pin Required</h3>
                <input type="password" id="delete-password" class="w-full border-2 p-5 rounded-2xl text-center mb-8 font-black text-3xl outline-none focus:border-red-500 font-bold" placeholder="••••">
                <div class="grid grid-cols-2 gap-4 font-bold"><button onclick="admin.closeDeleteModal()" class="bg-gray-100 py-3 rounded-2xl font-bold uppercase text-[10px]">Cancel</button><button onclick="admin.confirmDelete()" class="bg-red-600 text-white py-3 rounded-2xl font-bold uppercase text-[10px]">Delete</button></div>
            </div>
        </div>

        <div id="printable-area" class="hidden font-bold"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, collection, onSnapshot, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Setup
        const firebaseConfigRaw = typeof __firebase_config !== 'undefined' ? __firebase_config : '{}';
        const firebaseConfig = JSON.parse(firebaseConfigRaw);
        let app, auth, db;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'sri-sai-vidyalayam';

        let updatesInitialLoad = true;
        let unseenUpdatesCount = 0;

        window.initCloud = async function() {
            if (!firebaseConfig.apiKey) {
                document.getElementById('cloud-loader').style.display = 'none';
                return;
            }
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else { await signInAnonymously(auth); }
                initSync();
                document.getElementById('cloud-loader').style.display = 'none';
            } catch (e) { document.getElementById('loader-text').innerHTML = "<span style='color:red;'>Link Broken.</span>"; }
        }

        const initSync = () => {
            if (!db) return;
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'students'), (snap) => {
                state.students = snap.docs.map(d => ({ firestoreId: d.id, ...d.data() }));
                if (document.getElementById('view-admin').offsetParent) { admin.renderDash(); admin.renderStudents(); }
            });
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'updates'), (snap) => {
                const newUpdates = snap.docs.map(d => ({ firestoreId: d.id, ...d.data() })).sort((a,b) => b.id - a.id);
                if (!updatesInitialLoad && newUpdates.length > state.updates.length) {
                    unseenUpdatesCount += (newUpdates.length - state.updates.length);
                    updateBadge();
                }
                state.updates = newUpdates;
                updatesInitialLoad = false;
                home.renderUpdates();
                if (document.getElementById('view-admin').offsetParent) admin.renderHistory();
            });
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'blogPosts'), (snap) => {
                state.blogPosts = snap.docs.map(d => ({ firestoreId: d.id, ...d.data() })).sort((a,b) => b.id - a.id);
                home.renderBlog();
                if (document.getElementById('view-admin').offsetParent) admin.renderBlogList();
            });
        };

        function updateBadge() {
            const b = document.getElementById('nav-updates-badge');
            const mb = document.getElementById('mobile-updates-badge');
            if (unseenUpdatesCount > 0) {
                [b, mb].forEach(el => { if(el){ el.innerText = unseenUpdatesCount; el.classList.remove('hidden'); } });
            } else {
                [b, mb].forEach(el => { if(el) el.classList.add('hidden'); });
            }
        }

        window.state = {
            isLoggedIn: false, activeStudentId: null, activeBlogIndex: 0,
            fees: { "Nursery": 15000, "LKG": 16000, "UKG": 17000, "1st Class": 18000, "2nd Class": 19000, "3rd Class": 20000, "4th Class": 21000, "5th Class": 22000, "6th Class": 23000, "7th Class": 24000, "8th Class": 25000, "9th Class": 28000, "10th Class": 30000 },
            students: [], updates: [], blogPosts: []
        };

        window.ui = {
            showToast: (msg, isError = false) => {
                const toast = document.getElementById('status-toast');
                toast.querySelector('#toast-msg').innerText = msg;
                toast.classList.remove('hidden');
                toast.classList.add('show');
                if(isError) toast.style.backgroundColor = '#991b1b';
                else toast.style.backgroundColor = '#1e1b4b';
                setTimeout(() => { toast.classList.add('hidden'); toast.classList.remove('show'); }, 3000);
            }
        };

        window.auth_manager = {
            login: (e) => {
                e.preventDefault();
                if(document.getElementById('userid').value === 'admin' && document.getElementById('password').value === '123') {
                    state.isLoggedIn = true; router.navigate('admin');
                } else ui.showToast('Invalid PIN', true);
            },
            logout: () => { state.isLoggedIn = false; router.navigate('home'); }
        };

        window.router = {
            navigate: (view) => {
                if(view === 'admin' && !state.isLoggedIn) return router.navigate('login');
                document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
                const target = document.getElementById(`view-${view}`);
                if (target) target.classList.remove('hidden');
                if (view === 'updates') { unseenUpdatesCount = 0; updateBadge(); }
                if(view === 'home' || view === 'updates') home.init();
                if(view === 'admin') admin.init();
                window.scrollTo(0,0);
            }
        };

        const parseVideoId = (url) => {
            if(!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        };

        window.home = {
            init: () => {
                const classOpts = Object.keys(state.fees).map(c => `<option value="${c}">${c}</option>`).join('');
                document.querySelectorAll('#board-class-filter, #home-class-filter').forEach(s => s.innerHTML = `<option value="All">All Classes</option>` + classOpts);
                home.renderUpdates(); home.renderBlog(); home.startTextSlider();
            },
            startTextSlider: () => {
                let slides = document.querySelectorAll('#hero-text-slider .slide');
                let current = 0; if(window.textInterval) clearInterval(window.textInterval);
                window.textInterval = setInterval(() => {
                    if(slides.length > 0) {
                        slides[current].classList.remove('active');
                        current = (current + 1) % slides.length;
                        slides[current].classList.add('active');
                    }
                }, 5000);
            },
            playMedia: (containerId, type, url) => {
                const container = document.getElementById(containerId);
                if(!container) return;
                if(type === 'youtube') {
                    container.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${parseVideoId(url)}?autoplay=1" frameborder="0" allowfullscreen allow="autoplay; encrypted-media"></iframe>`;
                } else if(type === 'local_video') {
                    container.innerHTML = `<video width="100%" height="100%" controls autoplay playsinline><source src="${url}" type="video/mp4"></video>`;
                } else if(type === 'instagram') {
                    const cleanUrl = url.split('?')[0].replace(/\/$/, "");
                    container.innerHTML = `<iframe width="100%" height="100%" src="${cleanUrl}/embed/" frameborder="0" scrolling="no"></iframe>`;
                }
            },
            nextBlog: () => {
                if (state.blogPosts.length <= 1) return;
                state.activeBlogIndex = (state.activeBlogIndex + 1) % state.blogPosts.length;
                home.updateBlogSlider();
            },
            prevBlog: () => {
                if (state.blogPosts.length <= 1) return;
                state.activeBlogIndex = (state.activeBlogIndex - 1 + state.blogPosts.length) % state.blogPosts.length;
                home.updateBlogSlider();
            },
            updateBlogSlider: () => {
                const track = document.getElementById('blog-posts-feed');
                if (track) {
                    track.style.transform = `translateX(-${state.activeBlogIndex * 100}%)`;
                }
            },
            renderBlog: () => {
                const feed = document.getElementById('blog-posts-feed');
                if (!feed) return;
                feed.innerHTML = state.blogPosts.map((p, idx) => {
                    let media = ''; const cid = `blog-media-${idx}`;
                    const isVertical = (p.type === 'instagram' || (p.type === 'youtube' && p.url && p.url.includes('shorts')));
                    
                    if (p.type === 'embed') {
                        media = `<div class="embed-wrapper h-full flex items-center justify-center min-h-[300px]">${p.embedCode}</div>`;
                    } else if(p.type === 'image') {
                        media = `<img src="${p.url}" class="w-full h-full object-cover rounded-[24px] shadow-md" style="max-height:450px">`;
                    } else {
                        media = `<div id="${cid}" class="video-container ${isVertical ? 'vertical' : ''}" onclick="home.playMedia('${cid}','${p.type}','${p.url}')"><div class="play-overlay"><span class="material-symbols-outlined text-6xl text-white font-bold">play_circle</span></div></div>`;
                    }
                    return `
                    <div class="blog-slide">
                        <div class="bg-white rounded-[3rem] p-8 shadow-xl border border-indigo-50 font-bold mx-auto max-w-lg">
                            ${media}
                            <div class="mt-8 text-left">
                                <h3 class="font-black text-2xl text-indigo-950 mb-3 uppercase tracking-tighter">${p.title}</h3>
                                <div class="text-xs text-slate-400 uppercase tracking-widest font-bold">${p.date} • ${p.type.replace('_',' ')}</div>
                            </div>
                        </div>
                    </div>`;
                }).join('') || '<div class="blog-slide text-center py-20 opacity-30 font-bold uppercase tracking-widest">No highlights found.</div>';
                
                state.activeBlogIndex = 0;
                home.updateBlogSlider();
            },
            renderUpdates: () => {
                const cls = document.getElementById('board-class-filter')?.value || 'All';
                const filtered = state.updates.filter(u => u.classGrade === 'All' || u.classGrade === cls);
                const list = document.getElementById('board-updates-list');
                if (list) list.innerHTML = filtered.map(u => `
                    <li class="bg-white p-6 rounded-3xl border-l-8 border-indigo-500 shadow-sm font-bold">
                        <div class="text-xs text-slate-400 uppercase font-black mb-1 font-bold">${u.category} • ${u.date}</div>
                        <p class="text-indigo-900 font-bold">${u.subject !== 'General' ? '<b>'+u.subject+':</b> ' : ''}${u.text}</p>
                    </li>`).join('') || '<p class="text-slate-400 text-center col-span-full font-bold">No updates found.</p>';
            }
        };

        window.admin = {
            init: () => {
                const opts = Object.keys(state.fees).map(c => `<option value="${c}">${c}</option>`).join('');
                document.querySelectorAll('#admit-class, #filter-class, #update-class').forEach(s => s.innerHTML = (s.id.includes('filter') || s.id.includes('update') ? '<option value="All">All Classes</option>' : '') + opts);
                const updateDate = document.getElementById('update-date'); if(updateDate) updateDate.valueAsDate = new Date();
                const blogDate = document.getElementById('blog-date'); if(blogDate) blogDate.valueAsDate = new Date();
                admin.renderDash(); admin.renderStudents();
            },
            switchTab: (tab) => {
                document.querySelectorAll('.admin-content').forEach(el => el.classList.add('hidden'));
                const target = document.getElementById(`tab-${tab}`);
                if(target) target.classList.remove('hidden');
                document.querySelectorAll('.admin-tab').forEach(b => b.classList.toggle('bg-blue-800', b.dataset.tab === tab));
                if(tab === 'manage_blog') admin.renderBlogList();
            },
            renderDash: () => {
                const canvas = document.getElementById('feeChart');
                if (!canvas) return; 
                let tT = 0, tP = 0, tO = 0;
                state.students.forEach(s => { tT += (s.totalFee + s.oldDue); tP += s.paid; tO += s.oldDue; });
                document.getElementById('stat-total').innerText = `₹${tT.toLocaleString()}`;
                document.getElementById('stat-old').innerText = `₹${tO.toLocaleString()}`;
                document.getElementById('stat-collected').innerText = `₹${tP.toLocaleString()}`;
                document.getElementById('stat-pending').innerText = `₹${(tT-tP).toLocaleString()}`;
                const ctx = canvas.getContext('2d');
                if(window.fChart) window.fChart.destroy();
                window.fChart = new Chart(ctx, { type: 'bar', data: { labels: ['Target', 'Paid', 'Due'], datasets: [{ data: [tT, tP, tT-tP], backgroundColor: ['#1e3a8a', '#10b981', '#ef4444'] }] }, options: { maintainAspectRatio: false } });
            },
            submitAdmission: async (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                const sId = Date.now().toString();
                const slip = document.getElementById('admit-slip').files[0];
                if(slip && slip.size > 700000) return ui.showToast('File too large (Max 700KB)', true);
                
                const save = (url) => {
                    const data = { id: sId, admnNo: fd.get('admnNo'), name: fd.get('name'), father: fd.get('father'), contact: fd.get('contact'), classGrade: fd.get('classGrade'), totalFee: parseFloat(fd.get('totalFee')), oldDue: parseFloat(fd.get('oldDue') || 0), paid: 0, history: [] };
                    const initPay = parseFloat(fd.get('initialPay') || 0);
                    if(initPay > 0) { data.paid = initPay; data.history.push({ receiptNo: 'REC-'+sId.slice(-4), date: new Date().toISOString().split('T')[0], amount: initPay, category: 'Academic Fee', mode: 'Cash' }); }
                    setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'students', sId), data).then(() => { ui.showToast('Saved'); e.target.reset(); admin.switchTab('students'); });
                };
                if(slip){ const r = new FileReader(); r.onload = (ev) => save(ev.target.result); r.readAsDataURL(slip); } else save(null);
            },
            renderStudents: () => {
                const body = document.getElementById('student-list-body');
                const filtered = state.students.filter(s => (document.getElementById('filter-class').value === 'All' || s.classGrade === document.getElementById('filter-class').value));
                body.innerHTML = filtered.map(s => `<tr class="border-b font-bold cursor-pointer hover:bg-slate-50" onclick="admin.openModal('${s.id}')"><td class="p-4 text-xs font-mono text-slate-400 font-bold">${s.admnNo}</td><td class="p-4 font-black">${s.name}</td><td class="p-4 font-medium text-slate-500 font-bold">${s.classGrade}</td><td class="p-4 text-orange-600 font-bold font-bold">₹${(s.oldDue||0).toLocaleString()}</td><td class="p-4 font-black">₹${((s.totalFee+s.oldDue)-s.paid).toLocaleString()}</td><td class="p-4 text-right font-bold"><button class="bg-blue-900 text-white px-3 py-1 rounded text-xs font-bold font-bold font-bold font-bold">Manage</button></td></tr>`).join('');
            },
            openModal: (id) => {
                state.activeStudentId = id; const s = state.students.find(x => x.id === id); if(!s) return;
                document.getElementById('modal-title').innerText = s.name;
                document.getElementById('modal-class').innerText = s.classGrade;
                document.getElementById('modal-father').innerText = s.father;
                document.getElementById('modal-contact').innerText = s.contact || 'N/A';
                document.getElementById('modal-fee-old').innerText = `₹${(s.oldDue||0).toLocaleString()}`;
                document.getElementById('modal-fee-due').innerText = `₹${((s.totalFee + s.oldDue) - s.paid).toLocaleString()}`;
                document.getElementById('modal-history').innerHTML = (s.history || []).map(h => `<tr class="font-bold"><td class="p-4 text-slate-400 uppercase text-[10px] font-bold">${h.date}</td><td class="p-4 font-black text-blue-900 uppercase text-[10px] tracking-widest font-bold">${h.category} (${h.mode || 'Cash'})</td><td class="p-4 text-right font-black text-emerald-600 font-bold">₹${h.amount.toLocaleString()}</td><td class="p-4 text-right font-bold"><button onclick="printer.printReceipt('${s.id}', '${h.receiptNo}')" class="text-blue-600 hover:text-blue-900 transition font-bold font-bold"><span class="material-symbols-outlined text-sm font-bold font-bold font-bold">print</span></button></td></tr>`).join('');
                document.getElementById('modal-slip-box').classList.toggle('hidden', !s.concessionSlipData);
                document.getElementById('profile-modal').classList.remove('hidden-modal');
                document.getElementById('pay-rec').value = 'REC-' + Date.now().toString().slice(-6);
                document.getElementById('pay-date').valueAsDate = new Date();
            },
            viewSlip: () => {
                const s = state.students.find(x => x.id === state.activeStudentId);
                const win = window.open(); win.document.write(`<iframe src="${s.concessionSlipData}" frameborder="0" style="width:100%; height:100%;"></iframe>`);
            },
            payFee: async (e) => {
                e.preventDefault();
                const s = state.students.find(x => x.id === state.activeStudentId);
                const amt = parseFloat(document.getElementById('pay-amt').value);
                s.paid += amt; s.history.push({ receiptNo: document.getElementById('pay-rec').value, date: document.getElementById('pay-date').value, category: document.getElementById('pay-category').value, mode: document.getElementById('pay-mode').value, amount: amt });
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'students', s.id), s);
                ui.showToast('Payment Saved'); admin.openModal(s.id);
            },
            addUpdate: async (e) => {
                e.preventDefault();
                const curCls = document.getElementById('update-class').value;
                const curSub = document.getElementById('update-subject').value;
                const data = { id: Date.now(), text: document.getElementById('update-text').value, category: document.getElementById('update-category').value, subject: document.getElementById('update-subject').value, classGrade: document.getElementById('update-class').value, date: document.getElementById('update-date').value };
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'updates'), data);
                ui.showToast('Posted'); document.getElementById('update-text').value = '';
                document.getElementById('update-class').value = curCls; document.getElementById('update-subject').value = curSub;
            },
            renderHistory: () => {
                document.getElementById('admin-updates-list').innerHTML = state.updates.map(u => `<li class="bg-slate-50 p-4 rounded-xl flex justify-between items-center border font-bold"><div><div class="text-xs text-gray-400 font-bold font-bold font-bold font-bold font-bold font-bold">${u.category} • ${u.subject}</div><div class="text-sm font-bold font-bold font-bold font-bold font-bold font-bold font-bold font-bold">${u.text}</div></div><button onclick="admin.deleteUpdate('${u.firestoreId}')" class="text-red-600 font-bold font-bold font-bold font-bold font-bold font-bold"><span class="material-symbols-outlined">delete</span></button></li>`).join('');
            },
            deleteUpdate: async (id) => { await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'updates', id)); ui.showToast('Removed'); },
            toggleBlogInputs: () => {
                const type = document.getElementById('blog-type').value;
                document.getElementById('blog-file-area').classList.toggle('hidden', type !== 'image' && type !== 'local_video');
                document.getElementById('blog-url-area').classList.toggle('hidden', type !== 'youtube' && type !== 'instagram');
                document.getElementById('blog-embed-area').classList.toggle('hidden', type !== 'embed');
            },
            addBlogPost: async (e) => {
                e.preventDefault();
                const type = document.getElementById('blog-type').value;
                const title = document.getElementById('blog-title').value;
                const date = document.getElementById('blog-date').value;
                const embedCode = document.getElementById('blog-embed').value;
                const savePost = async (url) => {
                    const data = { id: Date.now(), title, date, type, url, embedCode: type === 'embed' ? embedCode : null };
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'blogPosts'), data);
                    ui.showToast('Post Live');
                    e.target.reset(); admin.toggleBlogInputs(); admin.renderBlogList();
                };
                if(type === 'image' || type === 'local_video') {
                    const file = document.getElementById('blog-file').files[0];
                    if(!file) return ui.showToast('Select file');
                    if(file.size > 700000) return ui.showToast('File too large (Max 700KB)', true);
                    const reader = new FileReader();
                    reader.onload = (ev) => savePost(ev.target.result);
                    reader.readAsDataURL(file);
                } else if (type === 'embed') {
                    savePost(null);
                } else {
                    savePost(document.getElementById('blog-url').value);
                }
            },
            renderBlogList: () => {
                document.getElementById('admin-blog-list').innerHTML = state.blogPosts.map(p => `<li class="flex justify-between items-center p-4 border rounded-xl font-bold bg-indigo-50/50"><div><div class="text-[9px] text-gray-400 uppercase font-bold font-bold font-bold">${p.type} • ${p.date}</div><div class="text-sm font-bold uppercase font-bold font-bold">${p.title}</div></div><button onclick="admin.deleteBlogPost('${p.firestoreId}')" class="text-red-600 font-bold font-bold font-bold font-bold font-bold font-bold font-bold font-bold font-bold font-bold font-bold font-bold font-bold"><span class="material-symbols-outlined">delete</span></button></li>`).join('');
            },
            deleteBlogPost: async (id) => { await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'blogPosts', id)); ui.showToast('Removed'); admin.renderBlogList(); },
            closeModal: () => document.getElementById('profile-modal').classList.add('hidden-modal'),
            showDeleteConfirm: () => { document.getElementById('delete-password').value = ''; document.getElementById('delete-modal').classList.remove('hidden-modal'); },
            closeDeleteModal: () => document.getElementById('delete-modal').classList.add('hidden-modal'),
            confirmDelete: async () => {
                if(document.getElementById('delete-password').value === '123' && db) {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'students', state.activeStudentId));
                    admin.closeDeleteModal(); admin.closeModal(); admin.renderStudents(); admin.renderDash(); ui.showToast('Deleted');
                } else ui.showToast('Invalid PIN', true);
            },
            exportExcel: () => { const d = state.students.map(s => ({"ID": s.admnNo, "Name": s.name, "Balance": (s.totalFee + s.oldDue) - s.paid})); const ws = XLSX.utils.json_to_sheet(d); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Students"); XLSX.writeFile(wb, `SSV_Data.xlsx`); }
        };

        window.printer = {
            printMasterLedger: () => {
                const rows = state.students.map(s => `<tr class="font-bold"><td style="border:1px solid #000; padding:8px;">${s.name}</td><td style="border:1px solid #000; padding:8px;">${s.classGrade}</td><td style="border:1px solid #000; padding:8px; text-align:right;">₹${((s.totalFee+s.oldDue)-s.paid).toLocaleString()}</td></tr>`).join('');
                document.getElementById('printable-area').innerHTML = `<div style="padding:20px; color:#000;"><center><h1>Master Ledger</h1></center><table style="width:100%; border-collapse:collapse; border:1px solid #000;"><thead><tr style="background:#eee;"><th>Name</th><th>Class</th><th>Balance</th></tr></thead><tbody>${rows}</tbody></table></div>`;
                document.getElementById('printable-area').classList.remove('hidden');
                setTimeout(() => { window.print(); document.getElementById('printable-area').classList.add('hidden'); }, 300);
            },
            printLedger: () => {
                const s = state.students.find(x => x.id === state.activeStudentId);
                document.getElementById('printable-area').innerHTML = `<div style="padding:40px; border:1px solid #000; color:#000;"><center><h1>Statement</h1><p>${s.name} - ${s.classGrade}</p></center><hr/>${s.history.map(h => `<p>${h.date}: ${h.category} (${h.mode || 'Cash'}) - ₹${h.amount.toLocaleString()}</p>`).join('')}<p><b>Total Balance: ₹${((s.totalFee+s.oldDue)-s.paid).toLocaleString()}</b></p></div>`;
                document.getElementById('printable-area').classList.remove('hidden');
                setTimeout(() => { window.print(); document.getElementById('printable-area').classList.add('hidden'); }, 300);
            },
            printReceipt: (id, r) => {
                const s = state.students.find(x => x.id === id);
                const h = s.history.find(x => x.receiptNo === r);
                document.getElementById('printable-area').innerHTML = `<div style="border:2px solid #000; padding:40px; color:#000;"><center><h1>FEE RECEIPT</h1><p>Sri Sai Vidyalayam</p></center><hr/><p>Receipt No: ${h.receiptNo}</p><p>Student: ${s.name}</p><p>Category: ${h.category}</p><h2>Amount: ₹${h.amount.toLocaleString()}/-</h2></div>`;
                document.getElementById('printable-area').classList.remove('hidden');
                setTimeout(() => { window.print(); document.getElementById('printable-area').classList.add('hidden'); }, 300);
            }
        };

        (async () => { await window.initCloud(); router.navigate('home'); })();
    </script>
</body>
</html>
