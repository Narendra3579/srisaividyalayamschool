<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sri Sai Vidyalayam - Admin Portal</title>
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- Fonts and Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
    <style>
        body { font-family: 'Open Sans', sans-serif; overflow-x: hidden; width: 100%; -webkit-tap-highlight-color: transparent; }
        h1, h2, h3, .brand-font { font-family: 'Playfair Display', serif; }
        .modal { transition: opacity 0.2s ease-in-out; }
        .hidden-modal { opacity: 0; pointer-events: none; }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; background: #0f172a; border-radius: 16px; md:border-radius: 24px; cursor: pointer; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        .video-container.vertical { padding-bottom: 177.77%; }
        .video-container iframe, .video-container video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none !important; object-fit: cover; }
        .embed-wrapper { width: 100%; border-radius: 16px; md:border-radius: 24px; overflow: hidden; background: #f8fafc; display: flex; justify-content: center; min-height: 300px; }
        .embed-wrapper iframe { width: 100% !important; border: none !important; min-height: 300px; }
        .blog-slider-container { position: relative; width: 100%; overflow: hidden; }
        .blog-slider-track { display: flex; transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1); }
        .blog-slide { flex: 0 0 100%; padding: 0 5px; md:padding: 0 10px; box-sizing: border-box; }
        #printable-area { display: none; }
        @media print {
            body * { visibility: hidden !important; }
            #printable-area, #printable-area * { visibility: visible !important; }
            #printable-area { display: block !important; position: absolute !important; left: 0 !important; top: 0 !important; width: 100% !important; background: white !important; color: black !important; padding: 0 !important; }
        }
        .cloud-slow { animation: drift 60s linear infinite; }
        .cloud-very-slow { animation: drift 90s linear infinite; }
        @keyframes drift { from { transform: translateX(-150px); } to { transform: translateX(110vw); } }
        .bird-fly { animation: flyAcross 80s linear infinite; }
        @keyframes flyAcross { from { transform: translate(-150px, 60px); } to { transform: translate(110vw, 30px); } }
        .bird-wing { animation: flap 2.5s ease-in-out infinite alternate; transform-origin: center; }
        @keyframes flap { from { transform: scaleY(1); } to { transform: scaleY(0.2); } }
        .bus-drive { animation: driveAcross 18s linear infinite; transform-box: fill-box; }
        @keyframes driveAcross { from { transform: translateX(850px); } to { transform: translateX(-350px); } }
        #hero-text-slider .slide { display: none; }
        #hero-text-slider .slide.active { display: block; animation: slideUpFade 0.8s ease-out; }
        @keyframes slideUpFade { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .nav-badge { position: absolute; top: 2px; right: -8px; background: #ef4444; color: white; font-size: 10px; font-weight: 800; padding: 2px 6px; border-radius: 9999px; border: 2px solid #1e1b4b; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0) scale(0.9);} 40% {transform: translateY(-3px) scale(1);} }
        .play-overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.3); transition: background 0.3s; z-index: 10; }
        .sync-pulse { width: 8px; height: 8px; background: #10b981; border-radius: 50%; display: inline-block; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(0.95); opacity: 0.7; } 70% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(0.95); opacity: 0.7; } }
        #cloud-loader { position: fixed; inset: 0; background: #f8fafc; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #admission-popup { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(200px); width: 90%; max-width: 400px; z-index: 50; transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #admission-popup.show { transform: translateX(-50%) translateY(0); }
        @media (min-width: 768px) { #admission-popup { left: 24px; transform: translateY(200px); } #admission-popup.show { transform: translateY(0); } }
        #admin-toast { position: fixed; top: 24px; right: 24px; z-index: 200; transition: all 0.3s ease; opacity: 0; pointer-events: none; transform: translateY(-20px); }
        #admin-toast.show { opacity: 1; pointer-events: auto; transform: translateY(0); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 w-full min-h-screen">

    <!-- SPLASH SCREEN -->
    <div id="cloud-loader">
        <div class="mb-6 flex space-x-2">
            <div class="w-4 h-4 bg-indigo-600 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
            <div class="w-4 h-4 bg-indigo-600 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
            <div class="w-4 h-4 bg-indigo-600 rounded-full animate-bounce" style="animation-delay: 0.3s"></div>
        </div>
        <p id="loader-text" class="text-xs font-bold tracking-[0.3em] uppercase text-indigo-900 text-center px-4">Sri Sai Vidyalayam</p>
    </div>

    <!-- FEEDBACK TOAST -->
    <div id="admin-toast" class="bg-indigo-950 text-white px-6 py-4 rounded-2xl shadow-2xl font-bold flex items-center gap-3">
        <span id="toast-icon" class="material-symbols-outlined text-amber-400">info</span>
        <span id="toast-msg">Action Successful</span>
    </div>

    <!-- NAVBAR -->
    <nav class="bg-indigo-950 text-white shadow-xl sticky top-0 z-40 no-print border-b border-indigo-800 w-full">
        <div class="w-full px-4 md:px-8 lg:px-12">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center space-x-3 md:space-x-4 cursor-pointer group" onclick="router.navigate('home')">
                    <!-- Logo Implementation -->
                    <div class="bg-white h-10 w-10 md:h-14 md:w-14 rounded-xl md:rounded-2xl flex items-center justify-center border-2 border-amber-400 transform group-hover:rotate-6 transition flex-shrink-0 overflow-hidden">
                        <img src="ssv logo 1.png" alt="SSV Logo" class="w-full h-full object-contain p-1" onerror="this.outerHTML='<span class=\'font-bold text-indigo-950 text-lg\'>SSV</span>'">
                    </div>
                    <div class="overflow-hidden">
                        <span class="bg-amber-500 text-indigo-950 px-3 py-1 rounded text-[10px] md:text-[14px] font-black uppercase tracking-wider mb-1 inline-block leading-none whitespace-nowrap">Recognised by Govt of AP</span>
                        <h1 class="text-lg md:text-2xl lg:text-3xl font-bold tracking-tight leading-none uppercase truncate">Sri Sai Vidyalayam</h1>
                        <p class="text-[8px] md:text-[9px] text-amber-400 uppercase tracking-[0.2em] md:tracking-[0.3em] font-black mt-1 font-bold whitespace-nowrap">Excellence in Education</p>
                    </div>
                </div>
                <div class="hidden md:flex space-x-2 lg:space-x-4 items-center font-bold">
                    <button class="hover:bg-indigo-800/50 px-3 py-2 rounded-lg transition text-xs lg:text-sm uppercase whitespace-nowrap" onclick="router.navigate('home')">Home</button>
                    <button class="relative hover:bg-indigo-800/50 px-3 py-2 rounded-lg transition text-xs lg:text-sm uppercase whitespace-nowrap" onclick="router.navigate('updates')">
                        Daily Updates
                        <span id="nav-updates-badge" class="nav-badge hidden">0</span>
                    </button>
                    <button class="bg-amber-500 hover:bg-amber-400 text-indigo-950 px-4 py-2.5 rounded-xl transition flex items-center gap-2 shadow-lg shadow-amber-500/20 text-xs uppercase font-bold whitespace-nowrap" onclick="router.navigate('login')">
                        <span class="material-symbols-outlined text-lg font-bold">admin_panel_settings</span> Admin
                    </button>
                </div>
                <button class="md:hidden p-2 rounded-lg bg-indigo-800" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
                    <span class="material-symbols-outlined text-2xl font-bold">menu</span>
                </button>
            </div>
        </div>
        <div class="hidden md:hidden bg-indigo-900 border-t border-indigo-800 p-4" id="mobile-menu">
            <button class="block w-full text-left py-3 px-4 rounded-xl hover:bg-indigo-800 mb-1 font-bold" onclick="router.navigate('home'); document.getElementById('mobile-menu').classList.add('hidden')">Home</button>
            <button class="block w-full text-left py-3 px-4 rounded-xl hover:bg-indigo-800 mb-1 relative font-bold" onclick="router.navigate('updates'); document.getElementById('mobile-menu').classList.add('hidden')">
                Daily Updates
                <span id="mobile-updates-badge" class="ml-2 inline-block bg-red-500 text-white px-2 py-0.5 rounded-full text-[10px] hidden">0</span>
            </button>
            <button class="block w-full text-left py-3 px-4 bg-amber-500 text-indigo-950 rounded-xl font-bold uppercase text-xs" onclick="router.navigate('login'); document.getElementById('mobile-menu').classList.add('hidden')">Admin Login</button>
        </div>
    </nav>

    <div id="app" class="w-full min-h-screen">
        <!-- VIEW: HOME -->
        <div id="view-home" class="min-h-screen hidden w-full">
            <!-- HERO -->
            <section class="hero-bg pt-12 md:pt-20 pb-12 border-b border-slate-200 w-full overflow-hidden">
                <div class="w-full px-4 md:px-12 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                    <div class="relative z-10 text-center lg:text-left space-y-6">
                        <span class="inline-block px-4 py-1.5 bg-indigo-100 text-indigo-700 rounded-full text-xs font-bold uppercase tracking-widest">Recognised by Govt of AP</span>
                        <div id="hero-text-slider" class="min-h-[180px] md:min-h-[220px]">
                            <div class="slide active">
                                <h2 class="text-4xl md:text-6xl lg:text-8xl font-extrabold text-indigo-950 leading-[1.1]">Pollution Free <br><span class="text-green-600 underline decoration-amber-400 underline-offset-8">Green Campus</span></h2>
                                <p class="text-lg md:text-xl text-slate-600 mt-4 font-medium leading-relaxed">A serene environment located away from city noise and dust, ensuring healthy learning.</p>
                            </div>
                            <div class="slide">
                                <h2 class="text-4xl md:text-6xl lg:text-8xl font-extrabold text-indigo-950 leading-[1.1]">Expert & <br><span class="text-orange-500 underline decoration-amber-400 underline-offset-8">Dedicated Faculty</span></h2>
                                <p class="text-lg md:text-xl text-slate-600 mt-4 font-medium leading-relaxed">Qualified subject experts committed to personalized attention and excellence.</p>
                            </div>
                            <div class="slide">
                                <h2 class="text-4xl md:text-6xl lg:text-8xl font-extrabold text-indigo-950 leading-[1.1]">Safe & Secure <br><span class="text-red-600 underline decoration-amber-400 underline-offset-8">No Traffic Risk</span></h2>
                                <p class="text-lg md:text-xl text-slate-600 mt-4 font-medium leading-relaxed">Located in a peaceful residential zone with zero heavy traffic risks for kids.</p>
                            </div>
                        </div>
                        <button onclick="router.navigate('updates')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-4 md:px-10 md:py-5 rounded-2xl font-bold shadow-xl transition active:scale-95 text-base md:text-lg">View Daily Board</button>
                    </div>
                    <div class="relative h-[300px] md:h-[400px] lg:h-[550px] w-full max-w-2xl mx-auto">
                        <svg viewBox="0 0 800 500" class="w-full h-full" preserveAspectRatio="xMidYMid meet">
                            <circle cx="700" cy="80" r="45" fill="#FFF176" />
                            <g class="bird-fly">
                                <g transform="translate(0,0)"><path class="bird-wing" d="M0,0 Q5,-8 10,0 Q15,-8 20,0" stroke="#334155" stroke-width="2" fill="none" /></g>
                                <g transform="translate(50,25)"><path class="bird-wing" d="M0,0 Q5,-8 10,0 Q15,-8 20,0" stroke="#334155" stroke-width="2" fill="none" /></g>
                                <g transform="translate(-30,50)"><path class="bird-wing" d="M0,0 Q5,-8 10,0 Q15,-8 20,0" stroke="#334155" stroke-width="2" fill="none" /></g>
                            </g>
                            <g class="cloud-very-slow" opacity="0.7">
                                <g transform="translate(100,120)"><circle cx="0" cy="0" r="25" fill="#87CEEB" /><circle cx="30" cy="0" r="30" fill="#87CEEB" /><circle cx="60" cy="0" r="25" fill="#87CEEB" /></g>
                            </g>
                            <g class="cloud-slow" opacity="0.9">
                                <g transform="translate(450,60)"><circle cx="0" cy="0" r="15" fill="#87CEEB" /><circle cx="15" cy="0" r="20" fill="#87CEEB" /><circle cx="35" cy="0" r="15" fill="#87CEEB" /></g>
                            </g>
                            <rect x="0" y="400" width="800" height="100" fill="#334155" />
                            <g class="bus-drive">
                                <rect x="0" y="340" width="160" height="70" rx="12" fill="#fbbf24" />
                                <rect x="15" y="350" width="30" height="20" rx="2" fill="#f8fafc" opacity="0.8" />
                                <rect x="55" y="350" width="30" height="20" rx="2" fill="#f8fafc" opacity="0.8" />
                                <rect x="95" y="350" width="50" height="20" rx="2" fill="#f8fafc" opacity="0.8" />
                                <circle cx="40" cy="410" r="12" fill="#1e293b" />
                                <circle cx="120" cy="410" r="12" fill="#1e293b" />
                                <text x="80" y="385" font-family="sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#431407">SRI SAI VIDYALAYAM</text>
                            </g>
                        </svg>
                    </div>
                </div>
            </section>
            
            <!-- HIGHLIGHTS SLIDER -->
            <section class="w-full px-4 md:px-12 py-20 text-center font-bold">
                <h2 class="text-3xl md:text-4xl font-black text-indigo-950 uppercase border-b-4 border-amber-400 inline-block pb-2 mb-12">Recent Highlights</h2>
                <div class="flex items-center justify-center gap-2 md:gap-6 max-w-6xl mx-auto">
                    <button onclick="home.prevBlog()" class="w-10 h-10 md:w-14 md:h-14 rounded-full bg-white shadow-lg flex items-center justify-center text-indigo-950 hover:bg-indigo-950 hover:text-white transition-all flex-shrink-0">
                        <span class="material-symbols-outlined font-bold text-sm md:text-base">arrow_back_ios_new</span>
                    </button>
                    <div class="blog-slider-container w-full">
                        <div id="blog-posts-feed" class="blog-slider-track"></div>
                    </div>
                    <button onclick="home.nextBlog()" class="w-10 h-10 md:w-14 md:h-14 rounded-full bg-white shadow-lg flex items-center justify-center text-indigo-950 hover:bg-indigo-950 hover:text-white transition-all flex-shrink-0">
                        <span class="material-symbols-outlined font-bold text-sm md:text-base">arrow_forward_ios</span>
                    </button>
                </div>
            </section>

            <!-- FOOTER -->
            <footer class="bg-indigo-950 text-indigo-100 pt-20 pb-12 w-full">
                <div class="w-full px-6 md:px-12">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-12 mb-16">
                        <div class="space-y-6">
                            <div class="flex items-center gap-3">
                                <div class="bg-white text-indigo-950 h-10 w-10 rounded-xl flex items-center justify-center font-bold text-lg">SSV</div>
                                <h3 class="text-xl font-black uppercase text-white">Sri Sai Vidyalayam</h3>
                            </div>
                            <p class="text-sm opacity-70 leading-relaxed font-bold">Excellence in education through holistic growth in a pollution-free environment.</p>
                        </div>
                        <div class="space-y-6">
                            <h4 class="text-amber-400 uppercase tracking-widest text-[10px] font-black">Contact Us</h4>
                            <ul class="space-y-4 font-bold">
                                <li class="flex gap-3"><span class="material-symbols-outlined text-amber-500">location_on</span><span class="text-sm">Pulagalipalem, Pendurthi,<br>Visakhapatnam, AP - 531173</span></li>
                                <li class="flex gap-3"><span class="material-symbols-outlined text-amber-500">call</span><span class="text-sm">8121218825</span></li>
                                <li class="flex gap-3"><span class="material-symbols-outlined text-amber-500">mail</span><span class="text-sm break-all">shriisaividyallayem@gmail.com</span></li>
                            </ul>
                        </div>
                        <div class="space-y-6">
                            <h4 class="text-amber-400 uppercase tracking-widest text-[10px] font-black">Links</h4>
                            <ul class="space-y-3 font-bold">
                                <li><button onclick="router.navigate('home')" class="text-sm hover:text-amber-400 transition">School Home</button></li>
                                <li><button onclick="router.navigate('updates')" class="text-sm hover:text-amber-400 transition">Daily Updates</button></li>
                                <li><button onclick="router.navigate('login')" class="text-sm hover:text-amber-400 transition">Admin Portal</button></li>
                            </ul>
                        </div>
                        <div class="space-y-6">
                            <h4 class="text-amber-400 uppercase tracking-widest text-[10px] font-black">Hours</h4>
                            <div class="bg-indigo-900/50 p-6 rounded-3xl border border-indigo-800 font-bold text-sm">
                                <div class="flex justify-between mb-2 gap-2"><span>Mon - Fri</span> <span class="font-black">8:30 AM - 4:30 PM</span></div>
                                <div class="flex justify-between mb-2 gap-2"><span>Sat</span> <span class="font-black">8:30 AM - 12:30 PM</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>

        <!-- VIEW: DAILY UPDATES -->
        <div id="view-updates" class="min-h-screen hidden bg-slate-50 py-12 w-full">
            <div class="w-full px-4 md:px-12 font-bold">
                <div class="text-center mb-8">
                    <h2 class="text-4xl md:text-5xl font-black text-indigo-950 uppercase tracking-tighter">Daily Board</h2>
                </div>
                <div class="bg-indigo-950 rounded-[30px] md:rounded-[40px] shadow-2xl p-6 md:p-12 mb-12 w-full overflow-hidden">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-6 mb-10">
                        <h3 class="text-2xl md:text-3xl font-black text-white uppercase flex items-center gap-3">
                            <span class="material-symbols-outlined text-amber-400 text-3xl md:text-5xl font-bold">campaign</span> Notice Board
                        </h3>
                        <div class="w-full md:w-80">
                            <select id="board-class-filter" class="w-full bg-indigo-900 border border-indigo-700 text-white rounded-2xl p-4 font-bold outline-none text-sm md:text-base" onchange="home.renderUpdates()"></select>
                        </div>
                    </div>
                    <ul id="board-updates-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6"></ul>
                </div>
                <div class="text-center"><button onclick="router.navigate('home')" class="text-indigo-600 font-bold hover:underline text-base md:text-lg">Back to Home</button></div>
            </div>
        </div>

        <!-- VIEW: LOGIN -->
        <div id="view-login" class="min-h-screen bg-gray-100 flex items-center justify-center p-4 hidden w-full">
            <div class="bg-white w-full max-w-md p-8 md:p-10 rounded-3xl shadow-2xl font-bold border border-gray-100">
                <div class="text-center mb-8">
                    <span class="material-symbols-outlined text-5xl md:text-6xl text-blue-900 mb-2 font-bold">admin_panel_settings</span>
                    <h2 class="text-2xl md:text-3xl font-bold uppercase">Admin Login</h2>
                </div>
                <form id="login-form" onsubmit="auth_manager.login(event)" class="space-y-6">
                    <div><label class="block text-sm font-bold text-slate-600">User ID</label><input type="text" id="userid" class="w-full border-2 p-3 rounded-xl outline-none focus:border-blue-500 font-bold" required></div>
                    <div><label class="block text-sm font-bold text-slate-600">Password</label><input type="password" id="password" class="w-full border-2 p-3 rounded-xl outline-none focus:border-blue-500 font-bold" required></div>
                    <button type="submit" class="w-full bg-blue-900 text-white font-black py-4 rounded-2xl shadow-lg transition active:scale-95 font-bold">Sign In</button>
                </form>
            </div>
        </div>

        <!-- VIEW: ADMIN PANEL -->
        <div id="view-admin" class="min-h-screen bg-gray-50 flex flex-col md:flex-row hidden font-bold w-full overflow-hidden">
            <div class="bg-blue-900 text-white w-full md:w-64 lg:w-72 flex-shrink-0 flex flex-col md:h-screen md:sticky top-0 no-print shadow-xl">
                <div class="p-6 md:p-8 border-b border-blue-800 font-black text-xl md:text-2xl flex items-center gap-2">
                    <span class="material-symbols-outlined text-yellow-400 font-bold">school</span> Admin Console
                </div>
                <nav class="flex-1 p-4 md:p-6 space-y-1 font-bold overflow-y-auto">
                    <button class="admin-tab w-full text-left px-4 py-3 md:py-4 rounded-xl hover:bg-blue-800 flex items-center gap-3 transition text-sm md:text-lg" data-tab="dashboard" onclick="admin.switchTab('dashboard')">Dashboard</button>
                    <button class="admin-tab w-full text-left px-4 py-3 md:py-4 rounded-xl hover:bg-blue-800 flex items-center gap-3 transition text-sm md:text-lg" data-tab="admissions" onclick="admin.switchTab('admissions')">Admissions</button>
                    <button class="admin-tab w-full text-left px-4 py-3 md:py-4 rounded-xl hover:bg-blue-800 flex items-center gap-3 transition text-sm md:text-lg" data-tab="students" onclick="admin.switchTab('students')">Records</button>
                    <button class="admin-tab w-full text-left px-4 py-3 md:py-4 rounded-xl hover:bg-blue-800 flex items-center gap-3 transition text-sm md:text-lg" data-tab="dailyboard" onclick="admin.switchTab('dailyboard')">Daily Board</button>
                    <button class="admin-tab w-full text-left px-4 py-3 md:py-4 rounded-xl hover:bg-blue-800 flex items-center gap-3 transition text-sm md:text-lg" data-tab="manage_blog" onclick="admin.switchTab('manage_blog')">Manage Blog</button>
                </nav>
                <div class="p-4 md:p-6 border-t border-blue-800 font-bold">
                    <button onclick="auth_manager.logout()" class="w-full bg-red-800 text-white py-3 rounded-xl font-bold">Logout</button>
                </div>
            </div>

            <div class="flex-1 p-4 md:p-8 lg:p-12 overflow-y-auto w-full">
                <!-- DASHBOARD -->
                <div id="tab-dashboard" class="admin-content space-y-8">
                    <h2 class="text-2xl md:text-3xl font-black">Overview</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6 md:gap-8 font-bold">
                        <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border-l-8 border-blue-500"><h4>Target</h4><div class="text-3xl md:text-4xl font-black text-blue-900" id="stat-total">₹0</div></div>
                        <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border-l-8 border-orange-400"><h4>Old Dues</h4><div class="text-3xl md:text-4xl font-black text-orange-600" id="stat-old">₹0</div></div>
                        <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border-l-8 border-green-500"><h4>Collected</h4><div class="text-3xl md:text-4xl font-black text-green-600" id="stat-collected">₹0</div></div>
                        <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border-l-8 border-red-500"><h4>Outstanding</h4><div class="text-3xl md:text-4xl font-black text-red-600" id="stat-pending">₹0</div></div>
                    </div>
                    <div class="bg-white p-4 md:p-8 rounded-2xl shadow-lg border min-h-[300px] h-[400px] md:h-[450px]"><canvas id="feeChart"></canvas></div>
                </div>

                <!-- ADMISSIONS -->
                <div id="tab-admissions" class="admin-content hidden space-y-6">
                    <h2 class="text-2xl md:text-3xl font-black">Enrollment</h2>
                    <form onsubmit="admin.submitAdmission(event)" class="bg-white rounded-[2rem] md:rounded-[3rem] shadow-xl p-6 md:p-10 border grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 font-bold">
                        <div><label class="block text-sm">Admission ID</label><input type="text" name="admnNo" class="w-full border-2 p-3 md:p-4 rounded-2xl focus:border-blue-500" required></div>
                        <div><label class="block text-sm">Class/Grade</label><select id="admit-class" name="classGrade" class="w-full border-2 p-3 md:p-4 rounded-2xl font-bold"></select></div>
                        <div><label class="block text-sm">Full Name</label><input type="text" name="name" class="w-full border-2 p-3 md:p-4 rounded-2xl" required></div>
                        <div><label class="block text-sm">Father's Name</label><input type="text" name="father" class="w-full border-2 p-3 md:p-4 rounded-2xl" required></div>
                        <div><label class="block text-sm">Contact (10 Digits)</label><input type="tel" name="contact" pattern="[0-9]{10}" maxlength="10" oninput="this.value = this.value.replace(/[^0-9]/g, '')" class="w-full border-2 p-3 md:p-4 rounded-2xl font-bold" required></div>
                        <div><label class="block text-sm">Slip (Max 500KB)</label><input type="file" id="admit-slip" name="concessionSlip" accept=".jpg,.jpeg,.png,.pdf" class="w-full border-2 p-2 rounded-2xl text-xs font-bold"></div>
                        <div class="col-span-full grid grid-cols-1 sm:grid-cols-3 gap-4 border-t pt-8">
                            <div><label class="block text-xs uppercase text-slate-400">Total Fee</label><input type="number" name="totalFee" class="w-full border-2 p-3 md:p-4 rounded-2xl font-black text-xl" required></div>
                            <div><label class="block text-xs uppercase text-slate-400">Old Due</label><input type="number" name="oldDue" value="0" class="w-full border-2 p-3 md:p-4 rounded-2xl text-orange-600 font-bold"></div>
                            <div><label class="block text-xs uppercase text-slate-400">Initial Pay</label><input type="number" name="initialPay" value="0" class="w-full border-2 p-3 md:p-4 rounded-2xl text-green-600 font-bold"></div>
                        </div>
                        <button type="submit" class="col-span-full bg-blue-600 text-white py-4 md:py-5 rounded-[2rem] font-black shadow-xl text-lg md:text-xl mt-4">Register Student</button>
                    </form>
                </div>

                <!-- RECORDS -->
                <div id="tab-students" class="admin-content hidden space-y-8 font-bold">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <h2 class="text-2xl md:text-3xl font-black">Student Database</h2>
                        <div class="flex gap-2 w-full md:w-auto">
                            <button onclick="printer.printMasterLedger()" class="flex-1 md:flex-none bg-indigo-700 text-white px-4 py-2 rounded-xl font-bold shadow-md text-sm whitespace-nowrap">Ledger</button>
                            <button onclick="admin.exportExcel()" class="flex-1 md:flex-none bg-indigo-950 text-white px-4 py-2 rounded-xl font-bold shadow-md text-sm whitespace-nowrap">Excel</button>
                        </div>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-4 font-bold">
                        <select id="filter-class" class="border-2 rounded-2xl bg-white px-6 py-2 font-bold w-full sm:w-auto" onchange="admin.renderStudents()"></select>
                        <input type="text" id="filter-search" class="border-2 rounded-2xl flex-1 px-4 py-3 font-bold text-base" placeholder="Search name or ID..." oninput="admin.renderStudents()">
                    </div>
                    <div class="bg-white rounded-[1.5rem] md:rounded-[3rem] shadow-xl overflow-x-auto border w-full">
                        <table class="min-w-full text-sm md:text-base">
                            <thead class="bg-gray-50 border-b">
                                <tr><th class="p-4 md:p-6 text-left">ID</th><th class="p-4 md:p-6 text-left">Name</th><th class="p-4 md:p-6 text-left">Grade</th><th class="p-4 md:p-6 text-left text-orange-600">Old Fee</th><th class="p-4 md:p-6 text-left font-black">Balance</th><th class="p-4 md:p-6 text-right">Action</th></tr>
                            </thead>
                            <tbody id="student-list-body" class="divide-y font-bold"></tbody>
                        </table>
                    </div>
                </div>

                <!-- BLOGS -->
                <div id="tab-manage_blog" class="admin-content hidden space-y-8">
                    <h2 class="text-2xl md:text-3xl font-black">Manage Highlights</h2>
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 lg:gap-12 font-bold">
                        <div class="bg-white p-6 md:p-10 rounded-[2rem] md:rounded-[3rem] shadow border">
                            <form onsubmit="admin.addBlogPost(event)" class="space-y-6">
                                <div><label class="block text-sm font-bold">Title</label><input type="text" id="blog-title" class="w-full border-2 p-3 md:p-4 rounded-2xl font-bold" required></div>
                                <div class="grid grid-cols-2 gap-4 md:gap-6">
                                    <input type="date" id="blog-date" class="border-2 p-3 md:p-4 rounded-2xl font-bold" required>
                                    <select id="blog-type" class="border-2 p-3 md:p-4 rounded-2xl font-bold" onchange="admin.toggleBlogInputs()">
                                        <option value="image">Photo</option><option value="local_video">Video</option><option value="youtube">YouTube</option><option value="instagram">Instagram</option><option value="embed">HTML</option>
                                    </select>
                                </div>
                                <div id="blog-file-area"><label class="block text-sm">Media (Max 500KB)</label><input type="file" id="blog-file" class="w-full border-2 p-2 rounded-2xl text-xs font-bold" accept="image/*,video/mp4"></div>
                                <div id="blog-url-area" class="hidden"><label class="block text-sm">URL</label><input type="text" id="blog-url" class="w-full border-2 p-3 md:p-4 rounded-2xl font-bold" placeholder="https://..."></div>
                                <div id="blog-embed-area" class="hidden"><label class="block text-sm">HTML Embed</label><textarea id="blog-embed" class="w-full border-2 p-4 rounded-2xl h-32 text-xs font-mono font-bold" placeholder="<iframe>"></textarea></div>
                                <button type="submit" class="w-full bg-orange-600 text-white py-4 md:py-5 rounded-[2rem] font-bold text-lg md:text-xl shadow-lg mt-4">Publish Post</button>
                            </form>
                        </div>
                        <div class="bg-white p-6 rounded-[2rem] md:rounded-[3rem] shadow h-[500px] lg:h-[650px] overflow-y-auto border">
                            <ul id="admin-blog-list" class="space-y-4 font-bold"></ul>
                        </div>
                    </div>
                </div>

                <!-- DAILY BOARD -->
                <div id="tab-dailyboard" class="admin-content hidden space-y-8">
                    <h2 class="text-2xl md:text-3xl font-black">Board Management</h2>
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 lg:gap-12 font-bold">
                        <form id="notice-form" onsubmit="admin.addUpdate(event)" class="bg-white p-6 md:p-10 rounded-[2rem] md:rounded-[3rem] shadow border space-y-6">
                            <div class="grid grid-cols-2 gap-4 md:gap-6">
                                <select id="update-class" class="border-2 p-3 md:p-4 rounded-2xl font-bold"></select>
                                <select id="update-category" class="border-2 p-3 md:p-4 rounded-2xl font-bold"><option>Homework</option><option>Class Test</option><option>Event</option><option>General News</option></select>
                            </div>
                            <select id="update-subject" class="w-full border-2 p-3 md:p-4 rounded-2xl font-bold">
                                <option value="General">General</option><option value="Telugu">Telugu</option><option value="Hindi">Hindi</option><option value="English">English</option><option value="Mathematics">Mathematics</option><option value="Science">Science</option><option value="Social">Social</option><option value="E.V.S">E.V.S</option>
                            </select>
                            <input type="date" id="update-date" class="w-full border-2 p-3 md:p-4 rounded-2xl font-bold" required>
                            <textarea id="update-text" class="w-full border-2 p-4 md:p-6 rounded-2xl h-48 font-bold text-base" placeholder="Write details here..." required></textarea>
                            <button type="submit" class="w-full bg-blue-600 text-white py-4 md:py-5 rounded-[2rem] font-bold text-lg md:text-xl shadow-lg mt-4">Post Notice</button>
                        </form>
                        <div class="bg-white p-6 rounded-[2rem] md:rounded-[3rem] shadow h-[500px] lg:h-[650px] overflow-y-auto border">
                            <ul id="admin-updates-list" class="space-y-4 font-bold"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADMISSION POPUP -->
        <div id="admission-popup" class="bg-white rounded-[2rem] shadow-2xl p-5 border-2 border-amber-400 no-print font-bold">
            <button onclick="document.getElementById('admission-popup').classList.remove('show')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600">
                <span class="material-symbols-outlined font-black text-xl">close</span>
            </button>
            <div class="flex items-start gap-3 md:gap-4">
                <div class="bg-amber-100 h-10 w-10 md:h-12 md:w-12 flex-shrink-0 flex items-center justify-center rounded-xl md:rounded-2xl">
                    <span class="material-symbols-outlined text-amber-600 font-bold">school</span>
                </div>
                <div>
                    <p class="text-[9px] text-amber-600 uppercase tracking-widest font-black mb-1">Enrolment Phase</p>
                    <h4 class="text-indigo-950 text-lg md:text-xl font-black leading-tight uppercase tracking-tighter">Admissions Open<br>2026-2027</h4>
                    <p class="text-[10px] md:text-[11px] text-slate-500 mt-2 font-bold leading-relaxed italic">"Nurturing young minds in a peaceful environment."</p>
                    <div class="mt-4">
                        <a href="tel:8121218825" class="bg-amber-500 hover:bg-amber-600 text-indigo-950 px-5 py-2.5 rounded-xl text-xs font-black uppercase shadow-lg shadow-amber-100 transition flex items-center justify-center gap-1 active:scale-95 w-full">
                            <span class="material-symbols-outlined text-sm font-bold">call</span> Call Now
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- PROFILE MODAL -->
        <div id="profile-modal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-70 hidden-modal modal no-print p-2 md:p-4">
            <div class="bg-white w-full max-w-6xl h-[95vh] md:h-[90vh] rounded-[2rem] md:rounded-[3rem] shadow-2xl flex flex-col overflow-hidden font-bold">
                <div class="bg-blue-900 text-white p-5 md:p-8 flex justify-between items-center font-bold">
                    <h2 id="modal-title" class="text-xl md:text-3xl font-black uppercase truncate"></h2>
                    <button onclick="admin.closeModal()" class="text-white text-3xl md:text-5xl font-bold">&times;</button>
                </div>
                <div class="flex-1 overflow-y-auto p-4 md:p-10 bg-gray-50">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 md:gap-12">
                        <div class="space-y-6 md:space-y-8">
                            <div class="bg-white p-6 rounded-[2rem] shadow border space-y-3 font-bold">
                                <p class="text-[10px] uppercase text-slate-400 font-black tracking-widest">Student Info</p>
                                <p class="text-base md:text-lg">Grade: <span id="modal-class" class="text-blue-900 font-black"></span></p>
                                <p class="text-base md:text-lg">Parent: <span id="modal-father"></span></p>
                                <p class="text-base md:text-lg">Mobile: <span id="modal-contact"></span></p>
                                <div id="modal-slip-box" class="hidden mt-4 border-t pt-4">
                                    <button onclick="admin.viewSlip()" class="w-full bg-indigo-50 text-indigo-700 py-3 rounded-2xl text-xs font-bold uppercase">View Slip</button>
                                </div>
                            </div>
                            <div class="bg-blue-50 p-6 rounded-[2rem] border border-blue-200 font-bold space-y-2">
                                <div class="flex justify-between text-sm"><span>Due:</span> <span id="modal-fee-old"></span></div>
                                <div class="flex justify-between text-red-600 font-black text-xl md:text-2xl border-t border-blue-100 pt-3"><span>Balance:</span> <span id="modal-fee-due"></span></div>
                            </div>
                            <div class="space-y-3">
                                <button onclick="printer.printLedger()" class="w-full bg-white border-2 p-4 rounded-[1.5rem] font-black shadow-sm hover:bg-slate-50 transition text-sm">Statement</button>
                                <button onclick="admin.showDeleteConfirm()" class="w-full bg-red-50 text-red-600 p-3 rounded-xl font-black uppercase text-[9px] border border-red-100 tracking-widest">Delete Record</button>
                            </div>
                        </div>
                        <div class="lg:col-span-2 space-y-8">
                            <form onsubmit="admin.payFee(event)" class="bg-white p-6 md:p-10 rounded-[2rem] md:rounded-[3rem] shadow border grid grid-cols-1 sm:grid-cols-2 gap-4 md:gap-6 font-bold">
                                <div class="col-span-full text-xs uppercase text-slate-400 mb-2 font-black tracking-widest">Collection</div>
                                <input type="text" id="pay-rec" class="border-2 p-3 rounded-xl font-bold" placeholder="Receipt #" required>
                                <input type="date" id="pay-date" class="border-2 p-3 rounded-xl font-bold" required>
                                <select id="pay-category" class="border-2 p-3 rounded-xl font-bold"><option>Academic Fee</option><option>Old Fee</option></select>
                                <select id="pay-mode" class="border-2 p-3 rounded-xl font-bold"><option>Cash</option><option>UPI</option><option>Bank</option></select>
                                <input type="number" id="pay-amt" class="col-span-full border-2 border-green-500 p-5 rounded-[1.5rem] font-black text-3xl text-center" placeholder="₹ Amount" required>
                                <button type="submit" class="col-span-full bg-green-600 text-white py-4 rounded-[1.5rem] font-bold text-lg shadow-lg active:scale-95">Record Payment</button>
                            </form>
                            <div class="bg-white rounded-[1.5rem] md:rounded-[3rem] shadow border overflow-hidden font-bold">
                                <div class="p-5 bg-gray-50 text-xs font-black uppercase tracking-widest border-b">History</div>
                                <table class="w-full text-xs md:text-sm text-left">
                                    <tbody id="modal-history" class="divide-y font-bold"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DELETE CONFIRMATION -->
        <div id="delete-modal" class="fixed inset-0 z-[110] flex items-center justify-center bg-black bg-opacity-80 hidden-modal modal">
            <div class="bg-white w-full max-w-sm rounded-[2.5rem] p-8 text-center shadow-2xl font-bold mx-4">
                <span class="material-symbols-outlined text-5xl text-red-600 mb-2 font-bold">security</span>
                <h3 class="text-lg font-black mb-4 text-red-600 uppercase tracking-widest">Admin PIN</h3>
                <input type="password" id="delete-password" class="w-full border-2 p-4 rounded-2xl text-center mb-6 font-black text-2xl outline-none focus:border-red-500" placeholder="••••">
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="admin.closeDeleteModal()" class="bg-gray-100 py-3 rounded-xl font-bold uppercase text-[10px]">Cancel</button>
                    <button onclick="admin.confirmDelete()" class="bg-red-600 text-white py-3 rounded-xl font-bold uppercase text-[10px]">Delete</button>
                </div>
            </div>
        </div>

        <div id="printable-area" class="hidden"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, collection, onSnapshot, addDoc, deleteDoc, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // CONFIGURATION
        const PASTE_YOUR_CONFIG_HERE = {
            apiKey: "AIzaSyCTBCeLms5kGsf966PB25I4H75i8BBxma0",
            authDomain: "sri-sai-vidyalayam-9a21e.firebaseapp.com",
            projectId: "sri-sai-vidyalayam-9a21e",
            storageBucket: "sri-sai-vidyalayam-9a21e.firebasestorage.app",
            messagingSenderId: "167964825322",
            appId: "1:167964825322:web:7d22c335f98dc468fda993"
        };

        const firebaseConfigRaw = typeof __firebase_config !== 'undefined' ? __firebase_config : JSON.stringify(PASTE_YOUR_CONFIG_HERE);
        const firebaseConfig = JSON.parse(firebaseConfigRaw);
        let app, auth, db, user;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'sri-sai-vidyalayam';

        window.showFeedback = (msg, type = 'success') => {
            const toast = document.getElementById('admin-toast');
            const toastMsg = document.getElementById('toast-msg');
            const toastIcon = document.getElementById('toast-icon');
            toastMsg.innerText = msg;
            toast.style.backgroundColor = type === 'success' ? '#064e3b' : '#7f1d1d';
            toastIcon.innerText = type === 'success' ? 'check_circle' : 'error';
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 4000);
        };

        window.initCloud = async function() {
            if (!firebaseConfig.apiKey) { 
                document.getElementById('cloud-loader').style.display = 'none'; 
                router.navigate('home');
                return; 
            }
            try {
                app = initializeApp(firebaseConfig); 
                auth = getAuth(app); 
                db = getFirestore(app);

                const initAuth = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                };
                await initAuth();
                onAuthStateChanged(auth, (u) => {
                    user = u;
                    if (u) {
                        initSync();
                        document.getElementById('cloud-loader').style.display = 'none';
                        router.navigate('home');
                        setTimeout(() => { document.getElementById('admission-popup').classList.add('show'); }, 3500);
                    }
                });
            } catch (e) {
                document.getElementById('loader-text').innerHTML = "<span style='color:red;'>Connection Error. Please check Firebase configuration.</span>";
            }
        }

        const initSync = () => {
            if (!db || !user) return;
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'students'), (snap) => {
                state.students = snap.docs.map(d => ({ firestoreId: d.id, ...d.data() }));
                if (document.getElementById('view-admin').offsetParent) { admin.renderDash(); admin.renderStudents(); }
            }, (err) => showFeedback('Firestore Sync Error', 'error'));
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'updates'), (snap) => {
                const newUpdates = snap.docs.map(d => ({ firestoreId: d.id, ...d.data() })).sort((a, b) => b.id - a.id);
                if (!updatesInitialLoad && newUpdates.length > state.updates.length) { unseenUpdatesCount += (newUpdates.length - state.updates.length); updateBadge(); }
                state.updates = newUpdates; updatesInitialLoad = false; home.renderUpdates();
                if (document.getElementById('view-admin').offsetParent) admin.renderHistory();
            });
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'blogPosts'), (snap) => {
                state.blogPosts = snap.docs.map(d => ({ firestoreId: d.id, ...d.data() })).sort((a, b) => b.id - a.id);
                home.renderBlog();
                if (document.getElementById('view-admin').offsetParent) admin.renderBlogList();
            });
        };

        window.state = {
            isLoggedIn: false, activeStudentId: null, activeBlogIndex: 0,
            fees: { "Nursery": 15000, "LKG": 16000, "UKG": 17000, "1st Class": 18000, "2nd Class": 19000, "3rd Class": 20000, "4th Class": 21000, "5th Class": 22000, "6th Class": 23000, "7th Class": 24000, "8th Class": 25000, "9th Class": 28000, "10th Class": 30000 },
            students: [], updates: [], blogPosts: []
        };
        let updatesInitialLoad = true;
        let unseenUpdatesCount = 0;

        function updateBadge() {
            const b = document.getElementById('nav-updates-badge');
            const mb = document.getElementById('mobile-updates-badge');
            [b, mb].forEach(el => { if(el){ el.innerText = unseenUpdatesCount; el.classList.toggle('hidden', unseenUpdatesCount <= 0); } });
        }

        window.auth_manager = {
            login: (e) => {
                e.preventDefault();
                if(document.getElementById('userid').value === 'admin' && document.getElementById('password').value === '123') {
                    state.isLoggedIn = true; router.navigate('admin');
                } else showFeedback('Invalid Admin Credentials', 'error');
            },
            logout: () => { state.isLoggedIn = false; router.navigate('home'); }
        };

        window.router = {
            navigate: (view) => {
                if(view === 'admin' && !state.isLoggedIn) return router.navigate('login');
                document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
                const target = document.getElementById(`view-${view}`);
                if (target) target.classList.remove('hidden');
                if (view === 'updates') { unseenUpdatesCount = 0; updateBadge(); }
                if(view === 'home' || view === 'updates') home.init();
                if(view === 'admin') admin.init();
                window.scrollTo(0,0);
            }
        };

        window.home = {
            init: () => {
                const classOpts = Object.keys(state.fees).map(c => `<option value="${c}">${c}</option>`).join('');
                const boardFilter = document.getElementById('board-class-filter');
                if (boardFilter) boardFilter.innerHTML = `<option value="All">All School Notices</option>` + classOpts;
                home.renderUpdates(); home.renderBlog(); home.startTextSlider();
            },
            startTextSlider: () => {
                let slides = document.querySelectorAll('#hero-text-slider .slide');
                let current = 0;
                if(window.textInterval) clearInterval(window.textInterval);
                window.textInterval = setInterval(() => {
                    if(slides.length > 0) {
                        slides[current].classList.remove('active');
                        current = (current + 1) % slides.length;
                        slides[current].classList.add('active');
                    }
                }, 5000);
            },
            playMedia: (containerId, type, url) => {
                const container = document.getElementById(containerId);
                if(!container) return;
                if(type === 'youtube') {
                    const id = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/|youtube\.com\/shorts\/)([^"&?\/\s]{11})/)?.[1];
                    container.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${id}?autoplay=1" frameborder="0" allowfullscreen allow="autoplay; encrypted-media"></iframe>`;
                } else if(type === 'local_video') {
                    container.innerHTML = `<video width="100%" height="100%" controls autoplay playsinline><source src="${url}" type="video/mp4"></video>`;
                } else if(type === 'instagram') {
                    container.innerHTML = `<iframe width="100%" height="100%" src="${url.split('?')[0].replace(/\/$/, "")}/embed/" frameborder="0" scrolling="no"></iframe>`;
                }
            },
            nextBlog: () => { if (state.blogPosts.length > 1) { state.activeBlogIndex = (state.activeBlogIndex + 1) % state.blogPosts.length; home.updateBlogSlider(); } },
            prevBlog: () => { if (state.blogPosts.length > 1) { state.activeBlogIndex = (state.activeBlogIndex - 1 + state.blogPosts.length) % state.blogPosts.length; home.updateBlogSlider(); } },
            updateBlogSlider: () => { const track = document.getElementById('blog-posts-feed'); if (track) track.style.transform = `translateX(-${state.activeBlogIndex * 100}%)`; },
            renderBlog: () => {
                const feed = document.getElementById('blog-posts-feed');
                if (!feed) return;
                feed.innerHTML = state.blogPosts.map((p, idx) => {
                    let media = '';
                    const cid = `blog-media-${idx}`;
                    const isVertical = (p.type === 'instagram' || (p.type === 'youtube' && p.url && p.url.includes('shorts')));
                    if (p.type === 'embed') media = `<div class="embed-wrapper h-full items-center justify-center">${p.embedCode}</div>`;
                    else if(p.type === 'image') media = `<img src="${p.url}" class="w-full h-full object-cover rounded-xl md:rounded-[24px] shadow-md max-h-[350px] md:max-h-[500px]">`;
                    else media = `<div id="${cid}" class="video-container ${isVertical ? 'vertical' : ''}" onclick="home.playMedia('${cid}','${p.type}','${p.url}')"><div class="play-overlay"><span class="material-symbols-outlined text-5xl md:text-6xl text-white font-bold">play_circle</span></div></div>`;
                    return `
                    <div class="blog-slide">
                        <div class="bg-white rounded-[2rem] md:rounded-[4rem] p-6 md:p-10 shadow-xl border border-indigo-50 font-bold mx-auto max-w-4xl">
                            ${media}
                            <div class="mt-6 md:mt-8 text-left font-bold">
                                <h3 class="font-black text-2xl md:text-3xl text-indigo-950 mb-2 uppercase tracking-tighter">${p.title}</h3>
                                <div class="text-[10px] text-slate-400 uppercase tracking-widest font-black">${p.date} • ${p.type}</div>
                            </div>
                        </div>
                    </div>`;
                }).join('') || '<div class="blog-slide text-center py-20 opacity-30 font-bold uppercase tracking-widest">No highlights found.</div>';
                state.activeBlogIndex = 0; home.updateBlogSlider();
            },
            renderUpdates: () => {
                const cls = document.getElementById('board-class-filter')?.value || 'All';
                const filtered = state.updates.filter(u => u.classGrade === 'All' || u.classGrade === cls);
                const list = document.getElementById('board-updates-list');
                if (list) {
                    list.innerHTML = filtered.map(u => `
                        <li class="bg-white p-6 md:p-8 rounded-[2rem] border-l-[10px] border-indigo-500 shadow-lg font-bold">
                            <div class="text-[10px] text-slate-400 uppercase mb-2 font-black tracking-widest">${u.category} • ${u.date}</div>
                            <p class="text-indigo-900 font-bold text-base md:text-lg leading-relaxed">
                                ${u.subject && u.subject !== 'General' ? '<span class="text-amber-600 uppercase text-xs font-black">['+u.subject+'] </span>' : ''}
                                ${u.text}
                            </p>
                        </li>
                    `).join('') || '<p class="text-slate-400 text-center col-span-full font-bold py-10">No notices found.</p>';
                }
            }
        };

        window.admin = {
            init: () => {
                const opts = Object.keys(state.fees).map(c => `<option value="${c}">${c}</option>`).join('');
                document.querySelectorAll('#admit-class, #filter-class, #update-class').forEach(s => {
                    s.innerHTML = (s.id.includes('filter') || s.id.includes('update') ? '<option value="All">All Classes</option>' : '') + opts;
                });
                document.getElementById('update-date').valueAsDate = new Date();
                admin.renderDash(); admin.renderStudents();
            },
            switchTab: (tab) => {
                document.querySelectorAll('.admin-content').forEach(el => el.classList.add('hidden'));
                const target = document.getElementById(`tab-${tab}`);
                if(target) target.classList.remove('hidden');
                document.querySelectorAll('.admin-tab').forEach(b => b.classList.toggle('bg-blue-800', b.dataset.tab === tab));
            },
            renderDash: () => {
                const canvas = document.getElementById('feeChart');
                if (!canvas) return;
                let tT = 0, tP = 0, tO = 0;
                state.students.forEach(s => { tT += (s.totalFee + s.oldDue); tP += s.paid; tO += s.oldDue; });
                document.getElementById('stat-total').innerText = `₹${tT.toLocaleString()}`;
                document.getElementById('stat-old').innerText = `₹${tO.toLocaleString()}`;
                document.getElementById('stat-collected').innerText = `₹${tP.toLocaleString()}`;
                document.getElementById('stat-pending').innerText = `₹${(tT-tP).toLocaleString()}`;
                const ctx = canvas.getContext('2d');
                if(window.fChart) window.fChart.destroy();
                window.fChart = new Chart(ctx, {
                    type: 'bar', data: { labels: ['Target', 'Paid', 'Due'], datasets: [{ data: [tT, tP, tT-tP], backgroundColor: ['#1e3a8a', '#10b981', '#ef4444'], borderRadius: 8 }] },
                    options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
                });
            },
            submitAdmission: async (e) => {
                e.preventDefault();
                if (!auth.currentUser) { showFeedback('Cloud error: Not Authenticated', 'error'); return; }
                const fd = new FormData(e.target);
                const sId = Date.now().toString();
                const slip = document.getElementById('admit-slip').files[0];
                const save = async (url) => {
                    try {
                        const data = { id: sId, admnNo: fd.get('admnNo'), name: fd.get('name'), father: fd.get('father'), contact: fd.get('contact'), classGrade: fd.get('classGrade'), totalFee: parseFloat(fd.get('totalFee')), oldDue: parseFloat(fd.get('oldDue') || 0), paid: 0, history: [], concessionSlipData: url };
                        const initPay = parseFloat(fd.get('initialPay') || 0);
                        if(initPay > 0) {
                            data.paid = initPay; data.history.push({ receiptNo: 'REC-'+sId.slice(-4), date: new Date().toISOString().split('T')[0], amount: initPay, category: 'Academic Fee', mode: 'Cash' });
                        }
                        await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'students', sId), data);
                        e.target.reset(); showFeedback('Student Registered Successfully'); admin.switchTab('students');
                    } catch (err) { showFeedback('Save Failed: ' + err.message, 'error'); }
                };
                if(slip) {
                    if (slip.size > 500000) { showFeedback('Slip too large (Max 500KB)', 'error'); return; }
                    const r = new FileReader(); r.onload = (ev) => save(ev.target.result); r.readAsDataURL(slip); 
                } else { save(null); }
            },
            renderStudents: () => {
                const body = document.getElementById('student-list-body');
                const filterClass = document.getElementById('filter-class').value;
                const search = document.getElementById('filter-search').value.toLowerCase();
                const filtered = state.students.filter(s => (filterClass === 'All' || s.classGrade === filterClass) && (s.name.toLowerCase().includes(search) || s.admnNo.includes(search)));
                body.innerHTML = filtered.map(s => `
                    <tr class="border-b font-bold cursor-pointer hover:bg-slate-50 transition" onclick="admin.openModal('${s.id}')">
                        <td class="p-4 md:p-6 text-xs font-mono text-slate-400">${s.admnNo}</td>
                        <td class="p-4 md:p-6 font-black uppercase text-indigo-950 text-sm md:text-base">${s.name}</td>
                        <td class="p-4 md:p-6 font-medium text-slate-500 text-xs md:text-sm">${s.classGrade}</td>
                        <td class="p-4 md:p-6 text-orange-600 text-xs md:text-sm">₹${(s.oldDue||0).toLocaleString()}</td>
                        <td class="p-4 md:p-6 font-black text-blue-900 text-sm md:text-lg">₹${((s.totalFee+s.oldDue)-s.paid).toLocaleString()}</td>
                        <td class="p-4 md:p-6 text-right"><button class="bg-blue-900 text-white px-4 py-2 rounded-lg text-[10px] font-black uppercase">Manage</button></td>
                    </tr>
                `).join('') || '<tr><td colspan="6" class="p-10 text-center opacity-40">No records found.</td></tr>';
            },
            openModal: (id) => {
                state.activeStudentId = id; const s = state.students.find(x => x.id === id); if(!s) return;
                document.getElementById('modal-title').innerText = s.name;
                document.getElementById('modal-class').innerText = s.classGrade;
                document.getElementById('modal-father').innerText = s.father;
                document.getElementById('modal-contact').innerText = s.contact || 'N/A';
                document.getElementById('modal-fee-old').innerText = `₹${(s.oldDue||0).toLocaleString()}`;
                document.getElementById('modal-fee-due').innerText = `₹${((s.totalFee + s.oldDue) - s.paid).toLocaleString()}`;
                document.getElementById('modal-history').innerHTML = (s.history || []).map(h => `<tr class="font-bold"><td class="p-4 text-slate-400 text-[9px]">${h.date}</td><td class="p-4 text-[9px] truncate">${h.category}</td><td class="p-4 text-right font-black text-emerald-600 text-sm">₹${h.amount.toLocaleString()}</td><td class="p-4 text-right"><button onclick="printer.printReceipt('${s.id}', '${h.receiptNo}')" class="text-blue-600"><span class="material-symbols-outlined text-lg">print</span></button></td></tr>`).join('');
                document.getElementById('modal-slip-box').classList.toggle('hidden', !s.concessionSlipData);
                document.getElementById('profile-modal').classList.remove('hidden-modal');
                document.getElementById('pay-rec').value = 'REC-' + Date.now().toString().slice(-6);
                document.getElementById('pay-date').valueAsDate = new Date();
                document.getElementById('pay-amt').value = '';
            },
            viewSlip: () => { const s = state.students.find(x => x.id === state.activeStudentId); const win = window.open(); win.document.write(`<iframe src="${s.concessionSlipData}" frameborder="0" style="width:100%; height:100%;"></iframe>`); },
            payFee: async (e) => {
                e.preventDefault();
                if (!auth.currentUser) { showFeedback('Cloud error', 'error'); return; }
                try {
                    const s = state.students.find(x => x.id === state.activeStudentId); const amt = parseFloat(document.getElementById('pay-amt').value);
                    s.paid += amt; if(!s.history) s.history = [];
                    s.history.push({ receiptNo: document.getElementById('pay-rec').value, date: document.getElementById('pay-date').value, category: document.getElementById('pay-category').value, mode: document.getElementById('pay-mode').value, amount: amt });
                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'students', s.id), s);
                    showFeedback('Payment Recorded Successfully'); admin.openModal(s.id);
                } catch (err) { showFeedback('Error: ' + err.message, 'error'); }
            },
            addUpdate: async (e) => {
                e.preventDefault();
                if (!auth.currentUser) { showFeedback('Cloud error', 'error'); return; }
                try {
                    const data = { id: Date.now(), text: document.getElementById('update-text').value, category: document.getElementById('update-category').value, subject: document.getElementById('update-subject').value, classGrade: document.getElementById('update-class').value, date: document.getElementById('update-date').value };
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'updates'), data);
                    document.getElementById('update-text').value = '';
                    showFeedback('Notice Posted Successfully');
                } catch (err) { showFeedback('Error: ' + err.message, 'error'); }
            },
            renderHistory: () => {
                document.getElementById('admin-updates-list').innerHTML = state.updates.map(u => `<li class="bg-slate-50 p-4 rounded-xl flex justify-between items-center border font-bold"><div><div class="text-[9px] text-gray-400 uppercase">${u.category}</div><div class="text-sm font-bold text-indigo-950">${u.text}</div></div><button onclick="admin.deleteUpdate('${u.firestoreId}')" class="text-red-600 p-2"><span class="material-symbols-outlined">delete</span></button></li>`).join('');
            },
            deleteUpdate: async (id) => { 
                if (!auth.currentUser) return;
                if(confirm("Delete this notice?")) {
                    try { await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'updates', id)); showFeedback('Notice Deleted'); } catch (err) { showFeedback('Error: ' + err.message, 'error'); }
                }
            },
            toggleBlogInputs: () => {
                const type = document.getElementById('blog-type').value;
                document.getElementById('blog-file-area').classList.toggle('hidden', type !== 'image' && type !== 'local_video');
                document.getElementById('blog-url-area').classList.toggle('hidden', type !== 'youtube' && type !== 'instagram');
                document.getElementById('blog-embed-area').classList.toggle('hidden', type !== 'embed');
            },
            addBlogPost: async (e) => {
                e.preventDefault();
                if (!auth.currentUser) { showFeedback('Cloud error', 'error'); return; }
                const type = document.getElementById('blog-type').value; const title = document.getElementById('blog-title').value; const date = document.getElementById('blog-date').value; const embedCode = document.getElementById('blog-embed').value;
                const savePost = async (url) => { 
                    try {
                        const data = { id: Date.now(), title, date, type, url, embedCode: type === 'embed' ? embedCode : null }; 
                        await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'blogPosts'), data); 
                        e.target.reset(); admin.toggleBlogInputs(); showFeedback('Post Published Successfully');
                    } catch (err) { showFeedback('Error: ' + err.message, 'error'); }
                };
                if(type === 'image' || type === 'local_video') {
                    const file = document.getElementById('blog-file').files[0];
                    if(file) {
                        if (file.size > 500000) { showFeedback('File too large (Max 500KB)', 'error'); return; }
                        const r = new FileReader(); r.onload = (ev) => savePost(ev.target.result); r.readAsDataURL(file); 
                    }
                } else if (type === 'embed') { savePost(null); } else { savePost(document.getElementById('blog-url').value); }
            },
            renderBlogList: () => {
                document.getElementById('admin-blog-list').innerHTML = state.blogPosts.map(p => `<li class="flex justify-between items-center p-4 border rounded-xl font-bold bg-indigo-50/50"><div><div class="text-[9px] text-gray-400 uppercase font-black">${p.type}</div><div class="text-sm font-black text-indigo-950">${p.title}</div></div><button onclick="admin.deleteBlogPost('${p.firestoreId}')" class="text-red-600 p-2"><span class="material-symbols-outlined">delete</span></button></li>`).join('');
            },
            deleteBlogPost: async (id) => { 
                if (!auth.currentUser) return;
                if(confirm("Delete highlight?")) {
                    try { await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'blogPosts', id)); showFeedback('Post Deleted'); } catch (err) { showFeedback('Error: ' + err.message, 'error'); }
                }
            },
            closeModal: () => document.getElementById('profile-modal').classList.add('hidden-modal'),
            showDeleteConfirm: () => { document.getElementById('delete-password').value = ''; document.getElementById('delete-modal').classList.remove('hidden-modal'); },
            closeDeleteModal: () => document.getElementById('delete-modal').classList.add('hidden-modal'),
            confirmDelete: async () => {
                if(document.getElementById('delete-password').value === '123' && db && auth.currentUser) {
                    try {
                        await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'students', state.activeStudentId));
                        admin.closeDeleteModal(); admin.closeModal(); showFeedback('Record Deleted Successfully');
                    } catch (err) { showFeedback('Error: ' + err.message, 'error'); }
                } else showFeedback('Incorrect System PIN', 'error');
            },
            exportExcel: () => {
                const d = state.students.map(s => ({ "ID": s.admnNo, "Name": s.name, "Class": s.classGrade, "Balance": (s.totalFee + s.oldDue) - s.paid }));
                const ws = XLSX.utils.json_to_sheet(d); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Records"); XLSX.writeFile(wb, `Student_Report.xlsx`);
            }
        };

        window.printer = {
            getHeader: (title) => {
                const now = new Date().toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' });
                return `
                <div style="text-align:center; margin-bottom:25px; border-bottom: 2px solid #1e1b4b; padding-bottom: 15px;">
                    <h1 style="margin:0; font-size:28px; font-family:serif; color:#1e1b4b; text-transform:uppercase;">SRI SAI VIDYALAYAM</h1>
                    <p style="margin:5px 0; font-size:12px; font-weight:bold; color:#475569;">Pulagalipalem, Pendurthi, Visakhapatnam, AP - 531173</p>
                    <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-top:10px;">
                        <span style="font-size:14px; background:#1e1b4b; color:white; padding:4px 12px; border-radius:4px; text-transform:uppercase; font-weight:bold;">${title}</span>
                        <span style="font-size:10px; color:#64748b;">Printed: ${now}</span>
                    </div>
                </div>`;
            },
            printMasterLedger: () => {
                const rows = state.students.map((s, idx) => `
                    <tr style="background:${idx % 2 === 0 ? '#ffffff' : '#f8fafc'}; border-bottom:1px solid #e2e8f0;">
                        <td style="padding:10px; font-family:monospace; font-size:12px;">${s.admnNo}</td>
                        <td style="padding:10px; font-weight:bold; text-transform:uppercase;">${s.name}</td>
                        <td style="padding:10px;">${s.classGrade}</td>
                        <td style="padding:10px; text-align:right; font-weight:bold; color:#b91c1c;">₹${((s.totalFee + s.oldDue) - s.paid).toLocaleString()}</td>
                    </tr>`).join('');
                
                document.getElementById('printable-area').innerHTML = `
                    <div style="padding:40px; color:#000; font-family: sans-serif;">
                        ${printer.getHeader('Master Balance Ledger')}
                        <table style="width:100%; border-collapse:collapse;">
                            <thead>
                                <tr style="background:#f1f5f9; text-align:left;">
                                    <th style="padding:12px; border-bottom:2px solid #cbd5e1;">Admn ID</th>
                                    <th style="padding:12px; border-bottom:2px solid #cbd5e1;">Student Name</th>
                                    <th style="padding:12px; border-bottom:2px solid #cbd5e1;">Grade</th>
                                    <th style="padding:12px; border-bottom:2px solid #cbd5e1; text-align:right;">Outstanding Balance</th>
                                </tr>
                            </thead>
                            <tbody>${rows}</tbody>
                        </table>
                    </div>`;
                document.getElementById('printable-area').classList.remove('hidden');
                setTimeout(() => { window.print(); document.getElementById('printable-area').classList.add('hidden'); }, 300);
            },
            printLedger: () => {
                const s = state.students.find(x => x.id === state.activeStudentId);
                const historyRows = s.history.map((h, idx) => `
                    <tr style="background:${idx % 2 === 0 ? '#ffffff' : '#f8fafc'}; border-bottom:1px solid #e2e8f0;">
                        <td style="padding:10px;">${h.date}</td>
                        <td style="padding:10px; font-weight:bold;">${h.receiptNo}</td>
                        <td style="padding:10px;">${h.category}</td>
                        <td style="padding:10px; font-size:11px;">${h.mode || 'Cash'}</td>
                        <td style="padding:10px; text-align:right; font-weight:bold; color:#047857;">₹${h.amount.toLocaleString()}</td>
                    </tr>`).join('');

                document.getElementById('printable-area').innerHTML = `
                    <div style="padding:40px; color:#000; font-family: sans-serif;">
                        ${printer.getHeader('Student Fee Statement')}
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:25px; padding:15px; background:#f1f5f9; border-radius:8px;">
                            <div>
                                <p style="margin:2px 0;"><strong>Student:</strong> ${s.name}</p>
                                <p style="margin:2px 0;"><strong>Admn ID:</strong> ${s.admnNo}</p>
                            </div>
                            <div style="text-align:right;">
                                <p style="margin:2px 0;"><strong>Grade:</strong> ${s.classGrade}</p>
                                <p style="margin:2px 0;"><strong>Parent:</strong> ${s.father}</p>
                            </div>
                        </div>
                        <table style="width:100%; border-collapse:collapse;">
                            <thead>
                                <tr style="background:#1e1b4b; color:white;">
                                    <th style="padding:12px; text-align:left;">Date</th>
                                    <th style="padding:12px; text-align:left;">Receipt #</th>
                                    <th style="padding:12px; text-align:left;">Category</th>
                                    <th style="padding:12px; text-align:left;">Mode</th>
                                    <th style="padding:12px; text-align:right;">Paid Amt</th>
                                </tr>
                            </thead>
                            <tbody>${historyRows}</tbody>
                        </table>
                        <div style="margin-top:30px; text-align:right; border-top:2px solid #e2e8f0; padding-top:15px;">
                            <p style="margin:5px 0; color:#64748b;">Target Yearly Fee: ₹${(s.totalFee + s.oldDue).toLocaleString()}</p>
                            <p style="margin:5px 0; color:#047857;">Total Paid: ₹${s.paid.toLocaleString()}</p>
                            <h2 style="margin:10px 0; font-size:24px; color:#b91c1c;">Net Balance Due: ₹${((s.totalFee + s.oldDue) - s.paid).toLocaleString()}</h2>
                        </div>
                    </div>`;
                document.getElementById('printable-area').classList.remove('hidden');
                setTimeout(() => { window.print(); document.getElementById('printable-area').classList.add('hidden'); }, 300);
            },
            printReceipt: (id, r) => {
                const s = state.students.find(x => x.id === id);
                const h = s.history.find(x => x.receiptNo === r);
                document.getElementById('printable-area').innerHTML = `
                    <div style="margin:20px auto; max-width:700px; padding:30px; border:8px double #1e1b4b; color:#000; font-family: sans-serif; position:relative;">
                        ${printer.getHeader('Official Fee Receipt')}
                        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                            <div>
                                <p style="margin:5px 0;"><strong>Receipt No:</strong> <span style="font-family:monospace; color:#b91c1c;">${h.receiptNo}</span></p>
                                <p style="margin:5px 0;"><strong>Payment Date:</strong> ${h.date}</p>
                            </div>
                            <div style="text-align:right;">
                                <p style="margin:5px 0;"><strong>Grade:</strong> ${s.classGrade}</p>
                                <p style="margin:5px 0;"><strong>Student ID:</strong> ${s.admnNo}</p>
                            </div>
                        </div>
                        <div style="margin:25px 0; font-size:16px; line-height:1.8;">
                            Received with thanks from <strong>${s.name}</strong>, S/o D/o <strong>${s.father}</strong>, 
                            the sum of <strong>₹${h.amount.toLocaleString()}/-</strong> 
                            towards <strong>${h.category}</strong> via <strong>${h.mode || 'Cash'}</strong>.
                        </div>
                        <div style="background:#f8fafc; padding:25px; border:2px dashed #1e1b4b; text-align:center; margin:30px 0;">
                            <span style="font-size:12px; color:#64748b; text-transform:uppercase; display:block; margin-bottom:5px;">Amount Paid</span>
                            <span style="font-size:36px; font-weight:900; color:#1e1b4b;">₹ ${h.amount.toLocaleString()}/-</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-top:60px;">
                            <div style="border-top:1px solid #000; width:150px; text-align:center; font-size:12px; padding-top:5px;">Parent Signature</div>
                            <div style="border-top:1px solid #000; width:150px; text-align:center; font-size:12px; padding-top:5px;">Office Accountant</div>
                        </div>
                        <div style="text-align:center; font-size:9px; color:#94a3b8; margin-top:40px; font-style:italic;">This is a computer generated receipt. Signature not mandatory for validation if stamped.</div>
                    </div>`;
                document.getElementById('printable-area').classList.remove('hidden');
                setTimeout(() => { window.print(); document.getElementById('printable-area').classList.add('hidden'); }, 300);
            }
        };
        (async () => { await window.initCloud(); })();
    </script>
</body>
</html>
